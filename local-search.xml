<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æœ‰è¶£çš„ç½‘ç«™ç¬¬ä¸€æœŸ</title>
    <link href="/posts/189e43e7/"/>
    <url>/posts/189e43e7/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ¾-Coding-Kitty"><a href="#ğŸ¾-Coding-Kitty" class="headerlink" title="ğŸ¾ Coding Kitty"></a>ğŸ¾ <a href="https://hostrider.com/">Coding Kitty</a></h1><p>ä¸€ä¸ªçŒ«å’ªç™½å™ªéŸ³ç½‘ç«™ï¼Œå®ƒä¸ä»…ä¸ºç¼–ç¨‹çˆ±å¥½è€…å¸¦æ¥å®é™ï¼Œè¿˜èå…¥äº†å¯çˆ±çš„ç¼–ç¨‹çŒ«å½¢è±¡ï¼Œè®©ç¼–ç¨‹æ—¶å…‰ä¸å†æ¯ç‡¥ã€‚ç½‘ç«™è®¾è®¡ä¸­ç©¿æ’çš„äº’åŠ¨å…ƒç´ ï¼Œä»¤äººçœ¼å‰ä¸€äº®ã€‚æ›´å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä½œè€…åœ¨<a href="https://hostrider.com/credits.html">Credits and Attributions</a>é¡µé¢ä¸Šè¯¦ç»†è®°å½•äº†ç½‘ç«™çš„æ„å»ºè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ‰€ä½¿ç”¨çš„å¼€æºä»£ç å’ŒéŸ³ä¹ï¼Œå½°æ˜¾å‡ºå¯¹åˆ›ä½œç¤¾åŒºçš„å°Šé‡ä¸çƒ­çˆ±ã€‚å¯¹äºå–œæ¬¢ç¼–ç¨‹çš„æœ‹å‹æ¥è¯´ï¼Œè¿™ç»å¯¹æ˜¯ä¸€ä¸ªä¸å®¹é”™è¿‡çš„å¯çˆ±è§’è½ã€‚<br><img src="/img/WebsiteRecommondation/codingkitty.png" alt="Coding Kitty"></p><h1 id="ğŸ“–-Canâ€™t-Sleep-Reads"><a href="#ğŸ“–-Canâ€™t-Sleep-Reads" class="headerlink" title="ğŸ“– Canâ€™t Sleep Reads"></a>ğŸ“– <a href="https://cantsleepreads.com/">Canâ€™t Sleep Reads</a></h1><p>è¿™ä¸ªç½‘ç«™å¯ä»¥éšæœºæ‰“å¼€ä¸€ä¸ªçŸ­ç¯‡å°è¯´æ•…äº‹ï¼Œçœ‹åŸŸåå°±çŸ¥é“ä½œè€…æ˜¯å¸Œæœ›æƒ³è®©å¤±çœ çš„äººçœ‹ä¹¦ç¡è§‰ï¼Œæ•…äº‹å†…å®¹éƒ½æ˜¯æ¥è‡ªä¸€äº›å…¬å…±èµ„æºæ²¡æœ‰ç‰ˆæƒé—®é¢˜ï¼Œè¿˜æŒºæœ‰æ„æ€ã€‚<br><img src="/img/WebsiteRecommondation/cantsleepread.png" alt="Can&#39;t Sleep Reads"></p><h1 id="ğŸ§°-Just-Free"><a href="#ğŸ§°-Just-Free" class="headerlink" title="ğŸ§° Just Free"></a>ğŸ§° <a href="https://www.justfree.io/">Just Free</a></h1><p>è¿™ä¸ªç½‘ç«™æ•´ç†äº†å¾ˆå¤šå…è´¹çš„åˆ›ä¸šè€…&#x2F;åˆ›ä½œè€…çš„å·¥å…·å’Œèµ„æºã€‚å…¶ä¸­åŒ…æ‹¬æˆªå›¾ç”Ÿæˆå™¨ã€AIå›¾æ ‡ç”Ÿæˆå™¨ã€å¹¿å‘Šæ¨¡æ‹Ÿç”Ÿæˆå™¨ã€å¹¿å‘Šæ–‡æ¡ˆç”Ÿæˆå™¨ã€Lead Magnetç”Ÿæˆå™¨ã€æ–‡æœ¬è½¬å›¾åƒç”Ÿæˆå™¨ã€åˆ›æ„å’Œæ–‡æ¡ˆæ¨¡æ¿ã€äº§å“æ¨¡å‹ç”Ÿæˆå™¨ã€æµè§ˆå™¨æ¨¡æ‹Ÿç”Ÿæˆå™¨ã€å¹»ç¯ç‰‡åˆ¶ä½œæŒ‡å—ã€Instagramæ¨¡æ¿å’ŒFaviconç”Ÿæˆå™¨ç­‰ã€‚<br><img src="/img/WebsiteRecommondation/justfree.png" alt="Just Free"></p><h1 id="ğŸ”œ-Upside-Down-Text-Generator"><a href="#ğŸ”œ-Upside-Down-Text-Generator" class="headerlink" title="ğŸ”œ Upside Down Text Generator"></a>ğŸ”œ <a href="https://upsidedowntext.top/">Upside Down Text Generator</a></h1><p>è¿™æ˜¯ä¸€ä¸ªç”¨æ¥ç¿»è½¬æ–‡æœ¬çš„å·¥å…·ï¼Œè¾“å…¥æ–‡æœ¬å†…å®¹ï¼Œä¼šä½¿ç”¨ä¸åŒçš„Unicodeå­—ç¬¦å°†å…¶ç¿»è½¬æˆé…·ç‚«çš„å€’ç½®æ–‡æœ¬ã€‚ä¾‹å¦‚ï¼šGood Morningçš„å€’ç½®å½¢å¼æ˜¯â…oop êŸ½oÉ¹uá´‰uÉ“<br><img src="/img/WebsiteRecommondation/updowntext.png" alt="Upside Down Text Generator"></p><h1 id="ğŸ—ƒï¸-Proximity-Glow-Cards"><a href="#ğŸ—ƒï¸-Proximity-Glow-Cards" class="headerlink" title="ğŸ—ƒï¸ Proximity Glow Cards"></a>ğŸ—ƒï¸ <a href="https://codepen.io/jh3y/pen/QWYPaax">Proximity Glow Cards</a></h1><p>ä¸€ä¸ªç‰¹åˆ«å¥½çœ‹çš„å¡ç‰‡æ•ˆæœä»£ç ï¼Œç›¸å…³ä»£ç å¯ä»¥å»ä¸Šé¢codepené“¾æ¥çœ‹ã€‚<br><img src="/img/WebsiteRecommondation/card.png" alt="Proximity Glow Cards"></p>]]></content>
    
    
    <categories>
      
      <category>æœ‰è¶£çš„ç½‘ç«™</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç«™åˆ†äº«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello Hexo</title>
    <link href="/posts/a2676cd4/"/>
    <url>/posts/a2676cd4/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><span id="more"></span><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>TFT_espiå›¾ç‰‡è½¬æ¢è„šæœ¬</title>
    <link href="/posts/fdd48e00/"/>
    <url>/posts/fdd48e00/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ç”¨Ardunioçš„TFT_espiè¿™ä¸ªåº“æ—¶æ¯æ¬¡æƒ³æ˜¾ç¤ºå›¾ç‰‡éƒ½è¦ç”¨æŸäº›å·²æœ‰çš„å·¥å…·è½¯ä»¶è½¬æ¢æˆbitmapæˆ–è€…æ•°ç»„ï¼Œä½†æ˜¯æˆ‘è§è¿‡çš„å·¥å…·éƒ½åªèƒ½ä¸€å¼ ä¸€å¼ çš„è½¬æ¢ï¼Œå¦‚æœæƒ³è½¬æ¢GIFæˆ–è€…è§†é¢‘çœŸçš„å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥å°±å†™äº†ä¸¤ä¸ªè„šæœ¬ã€‚</p></blockquote><span id="more"></span><p>å®Œæ•´ä»£ç åœ¨<a href="https://gitee.com/Zone2515/esp32/tree/master/%E5%A4%A9%E6%B0%94%E6%97%B6%E9%92%9F/%E5%9B%BE%E5%83%8F%E8%BD%AC%E6%8D%A2%E8%84%9A%E6%9C%AC">å›¾åƒè½¬æ¢è„šæœ¬</a>ï¼Œè¿™é‡Œåªè®°å½•ä¸€äº›å…³é”®çš„åœ°æ–¹ã€‚</p><h2 id="å…³é”®ç‚¹"><a href="#å…³é”®ç‚¹" class="headerlink" title="å…³é”®ç‚¹"></a>å…³é”®ç‚¹</h2><p>è®¸å¤šå›¾å½¢åº“æä¾›çš„æ¥å£éƒ½æ˜¯æ˜¾ç¤ºbitmapæˆ–è€…å›¾åƒæ•°ç»„æ˜¯ï¼Œæ‰€ä»¥æˆ‘å…ˆæŠŠå¸¸è§æ ¼å¼çš„å›¾ç‰‡æˆ–è€…åŠ¨å›¾è½¬æˆbmpï¼Œç„¶åå†æŠŠRGB888çš„bmpè½¬æˆRGB565çš„æ•°ç»„ã€‚</p><h3 id="æŒ‰ç³»ç»Ÿé¡ºåºè¯»å–ç›®å½•ä¸‹æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶"><a href="#æŒ‰ç³»ç»Ÿé¡ºåºè¯»å–ç›®å½•ä¸‹æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶" class="headerlink" title="æŒ‰ç³»ç»Ÿé¡ºåºè¯»å–ç›®å½•ä¸‹æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶"></a>æŒ‰ç³»ç»Ÿé¡ºåºè¯»å–ç›®å½•ä¸‹æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶</h3><p>åƒos.listdir()æˆ–è€…glob.glob()è¿”å›åœ°é¡ºåºæ˜¯ä¹±çš„ï¼Œå¯¹äºæ–‡ä»¶åæœ‰è§„å¾‹åœ°å¯ä»¥è‡ªå·±å®ç°æ’åºï¼Œä½†æ˜¯å¯¹äºæ²¡æœ‰è§„å¾‹çš„è‡ªå·±æ’åºè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚</p><p><code>natsort</code>è¿™ä¸ªåŒ…å¯ä»¥å¯¹æ–‡ä»¶åæ’åºï¼Œéå¸¸æ–¹ä¾¿åœ°æ’æˆå’Œæˆ‘ä»¬åœ¨èµ„æºç®¡ç†å™¨çœ‹åˆ°çš„æ–‡ä»¶é¡ºåºä¸€æ ·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_image_files</span>(<span class="hljs-params">folder_path</span>):<br>    pattern = <span class="hljs-string">r&quot;.*\.(jpg|jpeg|png|bmp|gif|webp|ico|pbm|pgm|ppm|mp4)$&quot;</span><br>    image_files = []<br>    files = os.listdir(folder_path)<br>    <span class="hljs-keyword">for</span> file_name <span class="hljs-keyword">in</span> natsorted(files,alg=ns.PATH):<br>        <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(pattern, file_name, re.IGNORECASE):<br>            image_files.append(os.path.join(folder_path, file_name))<br>    <span class="hljs-keyword">return</span> image_files<br></code></pre></td></tr></table></figure><h3 id="è¯»å–GIF"><a href="#è¯»å–GIF" class="headerlink" title="è¯»å–GIF"></a>è¯»å–GIF</h3><p>ç¼©æ”¾æŒ‡å®šå¤§å°ï¼Œå‡åŒ€é‡‡æ ·æŒ‡å®šå¸§æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_gif</span>(<span class="hljs-params">gif: Image.Image, dsize: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>], maximum_frames=<span class="hljs-number">0</span></span>) -&gt; <span class="hljs-built_in">list</span>[Image.Image]:<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    @param gif: Image æºGIF</span><br><span class="hljs-string">    @param dsize: (int,int) ç›®æ ‡å›¾åƒçš„(å®½åº¦ï¼Œé«˜åº¦)</span><br><span class="hljs-string">    @param maximum_frames: int ä¿ç•™å¸§æ•°</span><br><span class="hljs-string">    @return [Image.Image,...]</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    frames = gif.n_frames<br>    gif.info[<span class="hljs-string">&#x27;frames&#x27;</span>] = frames<br>    f = <span class="hljs-built_in">min</span>(frames, maximum_frames) <span class="hljs-keyword">if</span> maximum_frames &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> frames<br>    step = math.ceil(frames/f)<br>    counter = <span class="hljs-number">0</span><br>    aframes = []<br>    <span class="hljs-keyword">for</span> frame <span class="hljs-keyword">in</span> ImageSequence.Iterator(gif):<br>        <span class="hljs-keyword">if</span> counter % step == <span class="hljs-number">0</span>:<br>            aframes.append(frame.resize(dsize))<br>        counter += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> aframes<br></code></pre></td></tr></table></figure><h3 id="è¯»å–mp4"><a href="#è¯»å–mp4" class="headerlink" title="è¯»å–mp4"></a>è¯»å–mp4</h3><p>è·ŸGIFç±»ä¼¼ï¼Œä½†æ˜¯PILæ²¡æ‰¾åˆ°è¯»å–æ—¶è§†é¢‘æ–‡ä»¶çš„æ–¹æ³•ï¼Œè¿™é‡Œç”¨äº†opencv</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_mp4</span>(<span class="hljs-params">file: <span class="hljs-built_in">str</span>, dsize: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>], maximum_frames=<span class="hljs-number">0</span></span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    @param file: str MP4æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-string">    @param dsize: (int,int) ç›®æ ‡å›¾åƒçš„(å®½åº¦ï¼Œé«˜åº¦)</span><br><span class="hljs-string">    @param maximum_frames: int ä¿ç•™å¸§æ•°</span><br><span class="hljs-string">    @return [Image.Image(), ...]</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    aframes = []<br>    cap = cv.VideoCapture(file)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cap.isOpened():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ— æ³•æ‰“å¼€è§†é¢‘æ–‡ä»¶:&quot;</span>, file)<br>        cap.release()<br>        <span class="hljs-keyword">return</span> aframes<br>    frames = <span class="hljs-built_in">int</span>(cap.get(cv.CAP_PROP_FRAME_COUNT))<br>    f = <span class="hljs-built_in">min</span>(frames, maximum_frames) <span class="hljs-keyword">if</span> maximum_frames &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> frames<br>    step = math.ceil(frames/f)<br>    ret = <span class="hljs-literal">True</span><br>    counter = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> ret:<br>        ret, frame = cap.read()<br>        <span class="hljs-keyword">if</span> frame <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            frame = cv.cvtColor(frame,cv.COLOR_BGR2RGB)<br>            <span class="hljs-keyword">if</span> counter % step == <span class="hljs-number">0</span>:<br>                aframes.append(Image.fromarray(cv.resize(frame,dsize)))<br>            counter+=<span class="hljs-number">1</span><br>    cap.release()<br>    <span class="hljs-keyword">return</span> aframes<br></code></pre></td></tr></table></figure><h3 id="bmpè½¬RGB565-hexæ•°ç»„"><a href="#bmpè½¬RGB565-hexæ•°ç»„" class="headerlink" title="bmpè½¬RGB565 hexæ•°ç»„"></a>bmpè½¬RGB565 hexæ•°ç»„</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">bmp_to_hex_RGB565</span>(<span class="hljs-params">filepath,head=<span class="hljs-string">&#x27;&#x27;</span>,tail=<span class="hljs-string">&#x27;&#x27;</span></span>) -&gt;<span class="hljs-built_in">str</span>:<br>    image = Image.<span class="hljs-built_in">open</span>(filepath)<br>    image = image.convert(<span class="hljs-string">&quot;RGB&quot;</span>)<br>    width, height = image.size<br>    image_data = []<br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):<br>            r, g, b = image.getpixel((x, y))<br>            pixel = ((r &amp; <span class="hljs-number">0xF8</span>) &lt;&lt; <span class="hljs-number">8</span>) | ((g &amp; <span class="hljs-number">0xFC</span>) &lt;&lt; <span class="hljs-number">3</span>) | (b &gt;&gt; <span class="hljs-number">3</span>)<br>            image_data.append(pixel)<br>    hex_data = [<span class="hljs-built_in">hex</span>(pixel) <span class="hljs-keyword">for</span> pixel <span class="hljs-keyword">in</span> image_data]<br>    <span class="hljs-keyword">return</span> head+<span class="hljs-built_in">str</span>(hex_data).replace(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;[&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>).replace(<span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>)+tail<br></code></pre></td></tr></table></figure><h2 id="è„šæœ¬ä½¿ç”¨è¯´æ˜"><a href="#è„šæœ¬ä½¿ç”¨è¯´æ˜" class="headerlink" title="è„šæœ¬ä½¿ç”¨è¯´æ˜"></a>è„šæœ¬ä½¿ç”¨è¯´æ˜</h2><h3 id="tobmp-py"><a href="#tobmp-py" class="headerlink" title="tobmp.py"></a>tobmp.py</h3><p>è¾“å…¥è¾“å‡ºå¦‚ä¸‹</p><ul><li>GIF&#x2F;mp4ğŸ‘‰æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºåŒåç›®å½•å­˜æ”¾bmp</li><li>å›¾ç‰‡æ–‡ä»¶&#x2F;å›¾ç‰‡æ–‡ä»¶ç›®å½•ğŸ‘‰æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºè¾“å‡ºç›®å½•å­˜æ”¾bmp</li></ul><p>options:</p><ul><li>-h, â€“help</li><li>-F FOLDERPATH, â€“folderpath FOLDERPATH<br>                å›¾ç‰‡æ‰€åœ¨æ–‡ä»¶å¤¹</li><li>-W WIDTH, â€“width WIDTH<br>                ç¼©æ”¾åå›¾åƒçš„å®½åº¦</li><li>-H HEIGHT, â€“height HEIGHT<br>                ç¼©æ”¾åå›¾åƒçš„é«˜åº¦</li><li>-f FRAMES, â€“frames FRAMES<br>                GIFæ–‡ä»¶ä¿ç•™å¸§æ•°</li><li>-v FRAMENUM, â€“framenum FRAMENUM<br>                æŸ¥çœ‹æ–‡ä»¶å¸§æ•°</li></ul><p><img src="https://n.sinaimg.cn/sinakd202042s/556/w356h200/20200402/d6ea-irtymmv4160044.gif" alt="gege.gif"></p><p>&gt;&gt;<code>python .\tobmp.py -F .\imgs\gege.gif -W 64 -H 64 -v 1</code></p><p>&gt;&gt;<code>æ–‡ä»¶å¸§æ•°ï¼š212</code></p><p>&gt;&gt;<code>python .\tobmp.py -F .\imgs\gege.gif -W 64 -H 64 -f 106</code></p><p>å°±ä¼šåœ¨imgsç›®å½•ä¸‹ç”Ÿæˆbmpsç›®å½•ï¼Œbmpsç›®å½•é‡Œæœ‰gegeç›®å½•ï¼Œgegeç›®å½•é‡Œæœ‰106å¼ 64Ã—64 bmpå›¾åƒå¹¶ä¸”æ–‡ä»¶åä¸º0-105ã€‚</p><h3 id="bmptohex-RGB565-py"><a href="#bmptohex-RGB565-py" class="headerlink" title="bmptohex_RGB565.py"></a>bmptohex_RGB565.py</h3><p>è¾“å…¥è¾“å‡ºå¦‚ä¸‹</p><ul><li>bmpæ–‡ä»¶ğŸ‘‰ä¸€ç»´æ•°ç»„</li><li>bmpæ‰€åœ¨ç›®å½•ğŸ‘‰nç»´æ•°ç»„</li></ul><p>options:</p><ul><li>-h, â€“help show this help message and exit</li><li>-F PATH, â€“path PATH  bmpå›¾ç‰‡æˆ–bmpå›¾ç‰‡ç›®å½•è·¯å¾„</li></ul><p>&gt;&gt;<code>python .\bmptohex_RGB565.py -F .\imgs\bmps\gege\</code></p><p>å°±ä¼šåœ¨imgs\bmps\gegeä¸‹ç”ŸæˆhexRGB565.txtæ–‡ä»¶ï¼Œå¤åˆ¶æ­¤å†…å®¹åˆ°Ardunioç¨åŠ ä¿®æ”¹å³å¯é£Ÿç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ardunio</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¯»ã€ŠTransformerã€‹</title>
    <link href="/posts/3d8c967c/"/>
    <url>/posts/3d8c967c/</url>
    
    <content type="html"><![CDATA[<blockquote><p>èŠ‚é€‰äº†éƒ¨åˆ†åŸè®ºæ–‡å†…å®¹ï¼Œè®¤çœŸè¯»ä¸€ä¸‹è¿™ç¯‡å¤§åé¼é¼çš„transformerï¼Œæ—¨åœ¨åŠ æ·±ç†è§£å’Œå­¦è‹±è¯­O(âˆ©_âˆ©)O</p></blockquote><span id="more"></span><h1 id="Attention-Is-All-You-Need"><a href="#Attention-Is-All-You-Need" class="headerlink" title="Attention Is All You Need"></a>Attention Is All You Need</h1><p>æœ‰ç‚¹éœ¸æ°”</p><h2 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h2><blockquote><p>The dominant sequence transduction models are based on complex recurrent or convolutional neural networks that include an encoder and a decoder.</p></blockquote><p>ä¸»æµçš„åºåˆ—è½¬æ¢æ¨¡å‹éƒ½æ˜¯åŸºäºåŒ…å«ç¼–ç å™¨å’Œè§£ç å™¨çš„å¾ªç¯æˆ–å·ç§¯ç¥ç»ç½‘ç»œã€‚</p><blockquote><p>The best performing models also connect the encoder and decoder through an attention mechanism. </p></blockquote><p>è¡¨ç°æœ€å¥½çš„æ¨¡å‹ä¹Ÿæ˜¯é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶è¿æ¥ç¼–ç å™¨å’Œè§£ç å™¨ã€‚</p><blockquote><p>We propose a new simple network architecture, the Transformer, based solely on attention mechanisms, dispensing with recurrence and convolutions entirely.</p></blockquote><p>æˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°å‹ç®€å•çš„ç½‘ç»œæ¶æ„ï¼ŒTransformerï¼ŒåªåŸºäºæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®Œå…¨ä¸éœ€è¦å¾ªç¯å’Œå·ç§¯ã€‚</p><blockquote><p>Experiments on two machine translation tasks show these models to be superior in quality while being more parallelizable and requiring significantly less time to train.</p></blockquote><p>åœ¨ä¸¤ä¸ªæœºå™¨ç¿»è¯‘ä»»åŠ¡çš„å®éªŒä¸Šè¡¨ç°å‡ºè¿™äº›æ¨¡å‹å…·æœ‰æ›´å¥½çš„è´¨é‡ï¼ŒåŒæ—¶å…·æœ‰æ›´å¼ºçš„å¹¶è¡Œæ€§ï¼Œè®­ç»ƒæ—¶é—´æ˜æ˜¾å‡å°‘ã€‚</p><blockquote><p>Our model achieves 28.4 BLEU on the WMT 2014 English-to-German translation task, improving over the existing best results, including ensembles, by over 2 BLEU. On the WMT 2014 English-to-French translation task, our model establishes a new single-model state-of-the-art BLEU score of 41.8 after training for 3.5 days on eight GPUs, a small fraction of the training costs of the best models from the literature. </p></blockquote><p>æˆ‘ä»¬çš„æ¨¡å‹åœ¨WMT2014è‹±è½¬å¾·ç¿»è¯‘ä»»åŠ¡ä¸Šå®ç°äº†28.4 BLEUï¼Œæ¯”ç›®å‰å…¨éƒ¨æœ€å¥½çš„ç»“æœæé«˜äº†2 BLEUã€‚åœ¨WMT2014è‹±è½¬æ³•ç¿»è¯‘ä»»åŠ¡ä¸Šï¼Œæˆ‘ä»¬çš„æ¨¡å‹åœ¨ 8ä¸ªGPUè®­ç»ƒäº†3å¤©åŠï¼ˆæ–‡çŒ®ä¸­æœ€å¥½æ¨¡å‹è®­ç»ƒæˆæœ¬çš„ä¸€å°éƒ¨åˆ†ï¼‰åä»¥41.8åˆ·æ–°äº†å•æ¨¡å‹æœ€é«˜çš„BLUEæˆç»©ã€‚</p><blockquote><p>We show that the Transformer generalizes well to other tasks by applying it successfully to English constituency parsing both with large and limited training data.</p></blockquote><p>æŠŠå®ƒæˆåŠŸç”¨åœ¨å¤§é‡å’Œæœ‰é™çš„è®­ç»ƒæ•°æ®çš„è‹±è¯­è¯­å¥æˆåˆ†åˆ†æè¡¨æ˜äº†Transformeråœ¨å…¶ä»–ä»»åŠ¡ä¸Šå…·æœ‰ä¸é”™çš„æ³›åŒ–æ€§ã€‚</p><h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1.Introduction"></a>1.Introduction</h2><blockquote><p>Recurrent neural networks, long short-term memory and gated recurrent neural networks in particular, have been firmly established as state of the art approaches in sequence modeling and transduction problems such as language modeling and machine translation. Numerous efforts have since continued to push the boundaries of recurrent language models and encoder-decoder architectures.</p></blockquote><p>RNNï¼Œç‰¹åˆ«æ˜¯LSTMå’Œé—¨æ§RNNï¼Œå·²ç»åœ¨åƒè¯­è¨€æ¨¡å‹åŒ–å’Œæœºå™¨ç¿»è¯‘è¿™æ ·çš„åºåˆ—æ¨¡å‹åŒ–å’Œè½¬æ¢é—®é¢˜è¢«åšå®šåœ°ç¡®ç«‹ä¸ºæœ€å…ˆè¿›çš„æ–¹æ³•ã€‚æ­¤åè®¸å¤šåŠªåŠ›ç»§ç»­æ¨åŠ¨å¾ªç¯è¯­è¨€æ¨¡å‹å’Œç¼–è§£ç æ¶æ„çš„è¾¹ç•Œã€‚</p><blockquote><p>Recurrent models typically factor computation along the symbol positions of the input and output sequences. Aligning the positions to steps in computation time, they generate a sequence of hidden states <code>$h_t$</code> , as a function of the previous hidden state <code>$h_&#123;t-1&#125;$</code> and the input for position <code>$t$</code> .</p></blockquote><p>å¾ªç¯æ¨¡å‹é€šå¸¸è€ƒè™‘æ²¿ç€è¾“å…¥å’Œè¾“å‡ºåºåˆ—çš„ç¬¦å·ä½ç½®è®¡ç®—ã€‚æŠŠä½ç½®å’Œè®¡ç®—æ—¶é—´çš„æ­¥æ•°å¯¹é½ï¼Œä»–ä»¬äº§ç”Ÿä¸€ä¸ªéšè—çŠ¶æ€åºåˆ—  <code>$h_t$</code> ï¼Œä½œä¸ºå…ˆå‰çš„éšè—çŠ¶æ€ <code>$h_&#123;t-1&#125;$</code> å’Œä½ç½® <code>$t$</code> è¾“å…¥çš„å‡½æ•°ã€‚</p><blockquote><p>This inherently sequential nature precludes parallelization within training examples, which becomes critical at longer sequence lengths, as memory constraints limit batching across examples.Recent work has achieved significant improvements in computational efficiency through factorization tricks and conditional computation, while also improving model performance in case of the latter. The fundamental constraint of sequential computation, however, remains.</p></blockquote><p>è¿™ç§å›ºæœ‰çš„é¡ºåºæ€§æ’é™¤äº†åœ¨è®­ç»ƒæ ·æœ¬æ—¶å¹¶è¡ŒåŒ–ï¼Œå¯¹äºè¾ƒé•¿çš„åºåˆ—å˜å¾—ä¸¥é‡å› ä¸ºå†…å­˜çº¦æŸé™åˆ¶æ ·æœ¬æ‰¹å¤„ç†ã€‚æœ€è¿‘çš„å·¥ä½œé€šè¿‡åˆ†è§£æŠ€å·§å’Œæ¡ä»¶è®¡ç®—å·²ç»æ˜¾è‘—æ”¹å–„äº†è®¡ç®—æ•ˆç‡ï¼ŒåŒæ—¶åè€…ä¹Ÿæé«˜äº†æ¨¡å‹æ€§èƒ½ã€‚ç„¶è€Œåºåˆ—è®¡ç®—çš„åŸºæœ¬é™åˆ¶ä»ç„¶å­˜åœ¨ã€‚</p><blockquote><p>Attention mechanisms have become an integral part of compelling sequence modeling and transduction models in various tasks, allowing modeling of dependencies without regard to their distance in the input or output sequences. In all but a few cases, however, such attention mechanisms are used in conjunction with a recurrent network.</p></blockquote><p>æ³¨æ„åŠ›æœºåˆ¶å·²ç»æˆä¸ºåœ¨è®¸å¤šä»»åŠ¡ä¸­å¼•äººæ³¨ç›®çš„åºåˆ—æ¨¡å‹å’Œè½¬æ¢æ¨¡å‹ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸å¯¹ä¾èµ–å…³ç³»è¿›è¡Œå»ºæ¨¡ï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬åœ¨è¾“å…¥æˆ–è¾“å‡ºåºåˆ—ä¸­çš„è·ç¦»ã€‚ç„¶è€Œé™¤äº†å°‘æ•°å¤–ï¼Œè¿™ç§æ³¨æ„åŠ›æœºåˆ¶è¢«ç”¨åœ¨ä¸å¾ªç¯ç½‘ç»œç»“åˆã€‚</p><blockquote><p>In this work we propose the Transformer, a model architecture eschewing recurrence and instead relying entirely on an attention mechanism to draw global dependencies between input and output. The Transformer allows for significantly more parallelization and can reach a new state of the art in translation quality after being trained for as little as twelve hours on eight P100 GPUs.</p></blockquote><p>è¿™æ¬¡æˆ‘ä»¬æå‡ºäº†Transformerï¼Œä¸€ç§é¿å…å¾ªç¯ä¹Ÿä¸å®Œå…¨ä¾èµ–æ³¨æ„åŠ›æœºåˆ¶æ¥æè¿°è¾“å…¥è¾“å‡ºé—´çš„å…¨å±€ä¾èµ–å…³ç³»çš„æ¨¡å‹æ¶æ„ã€‚Transformeræ˜æ˜¾å…è®¸æ›´å¼ºçš„å¹¶è¡ŒåŒ–å¹¶ä¸”èƒ½å¤Ÿåœ¨8ä¸ªP100 GPUä¸Šè¢«è®­ç»ƒä»…12ä¸ªå°æ—¶åè¾¾åˆ°ç¿»è¯‘è´¨é‡çš„ä¸€ä¸ªæ–°å¢ƒç•Œã€‚</p><h2 id="2-Background"><a href="#2-Background" class="headerlink" title="2.Background"></a>2.Background</h2><blockquote><p>The goal of reducing sequential computation also forms the foundation of the Extended Neural GPU, ByteNet and ConvS2S, all of which use convolutional neural networks as basic building block, computing hidden representations in parallel for all input and output positions. In these models, the number of operations required to relate signals from two arbitrary input or output positions grows in the distance between positions, linearly for ConvS2S and logarithmically for ByteNet. This makes it more difficult to learn dependencies between distant positions. In the Transformer this is reduced to a constant number of operations, albeit at the cost of reduced effective resolution due to averaging attention-weighted positions, an effect we counteract with Multi-Head Attention as described in section 3.2.</p></blockquote><p>å‡å°‘é¡ºåºè®¡ç®—çš„ç›®æ ‡ä¹Ÿå½¢æˆäº†Extended Neural GPUï¼ŒByteNetå’ŒConvS2Sçš„åŸºç¡€ï¼Œä»–ä»¬éƒ½ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œä½œä¸ºåŸºç¡€æ„å»ºå—ï¼Œå¯¹æ‰€æœ‰çš„è¾“å…¥è¾“å‡ºä½ç½®å¹¶è¡Œè®¡ç®—éšè—å±‚ã€‚åœ¨è¿™äº›æ¨¡å‹ä¸­ï¼Œå°†ä»»æ„ä¸¤ä¸ªè¾“å…¥æˆ–è¾“å‡ºä½ç½®ä¿¡å·å…³è”èµ·æ¥çš„å‚æ•°éšç€ä¸¤ä¸ªä½ç½®çš„è·ç¦»å¢é•¿ï¼ŒConS2Sæ˜¯çº¿æ€§çš„ï¼ŒByteNetæ˜¯å¯¹æ•°çš„ã€‚è¿™ä½¿å¾—è¿œè·ç¦»ä½ç½®çš„ä¾èµ–å…³ç³»éš¾ä»¥å­¦ä¹ ã€‚åœ¨Transformerä¸­å°½ç®¡ç”±äºå¹³å‡æ³¨æ„åŠ›åŠ æƒä½ç½®å‡å°‘æœ‰æ•ˆåˆ†è¾¨ç‡ä¸ºä»£ä»·ï¼Œè¿™è¢«ç®€åŒ–æˆä¸€ä¸ªå¸¸é‡ï¼Œæˆ‘ä»¬ç”¨åœ¨3.2èŠ‚æè¿°çš„å¤šå¤´æ³¨æ„åŠ›æ¥æŠµæ¶ˆè¿™ä¸ªæ•ˆæœã€‚</p><blockquote><p>Self-attention, sometimes called intra-attention is an attention mechanism relating different positions of a single sequence in order to compute a representation of the sequence. Self-attention has been used successfully in a variety of tasks including reading comprehension, abstractive summarization, textual entailment and learning task-independent sentence representations.</p></blockquote><p>è‡ªæ³¨æ„åŠ›ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºå†…æ³¨æ„åŠ›ï¼Œæ˜¯ä¸€ç§å…³äºä¸€ä¸ªä¿¡å·åºåˆ—çš„ä¸åŒä½ç½®çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œä¸ºäº†è®¡ç®—è¿™ä¸ªåºåˆ—çš„è¡¨å¾ã€‚è‡ªæ³¨æ„åŠ›å·²ç»è¢«æˆåŠŸåœ°ç”¨åœ¨å„ç§å„æ ·çš„ä»»åŠ¡ä¸­åŒ…æ‹¬é˜…è¯»ç†è§£ï¼ŒæŠ½è±¡æ¦‚æ‹¬ï¼Œæ–‡æœ¬è¯­ä¹‰å’Œä¾èµ–äºè¯­å¥ç‰¹å¾çš„å­¦ä¹ ä»»åŠ¡ã€‚</p><blockquote><p>End-to-end memory networks are based on a recurrent attention mechanism instead of sequence aligned recurrence and have been shown to perform well on simple-language question answering and language modeling tasks.</p></blockquote><p>ç«¯åˆ°ç«¯è®°å¿†ç½‘ç»œåŸºäºå¾ªç¯æ³¨æ„åŠ›æœºåˆ¶è€Œä¸æ˜¯åºåˆ—å¯¹é½çš„å¾ªç¯å¹¶ä¸”å·²è¢«è¯æ˜åœ¨ç®€å•è¯­è¨€é—®ç­”å’Œè¯­è¨€å»ºæ¨¡ä»»åŠ¡ä¸Šè¡¨ç°å¾ˆå¥½ã€‚</p><blockquote><p>To the best of our knowledge, however, the Transformer is the first transduction model relying entirely on self-attention to compute representations of its input and output without using sequence-aligned RNNs or convolution. </p></blockquote><p>ç„¶è€Œï¼Œæ®æˆ‘ä»¬æ‰€çŸ¥ï¼ŒTransformeræ˜¯ç¬¬ä¸€ä¸ªæ²¡æœ‰ä½¿ç”¨åºåˆ—å¯¹é½çš„RNNæˆ–è€…å·ç§¯å®Œå…¨ä¾èµ–è‡ªæ³¨æ„åŠ›æ¥è®¡ç®—è¾“å…¥è¾“å‡ºçš„ç‰¹å¾çš„è½¬æ¢æ¨¡å‹ã€‚</p><h2 id="3-Model-Architecture"><a href="#3-Model-Architecture" class="headerlink" title="3.Model Architecture"></a>3.Model Architecture</h2><blockquote><p>Most competitive neural sequence transduction models have an encoder-decoder structure. Here, the encoder maps an input sequence of symbol representations (<code>$x_1,...,x_n$</code>) to a sequence of continuous representations <code>$z=(z_1,...,z_n)$</code> Given <code>$z$</code> , the decoder then generates an output sequence <code>$(y_1,...,y_m)$</code> of symbols one element at a time. At each step the model is auto-regressive, consuming the previously generated symbols as additional input when generating the next.</p></blockquote><p>å¤§å¤šå…·æœ‰ç«äº‰åŠ›çš„ç¥ç»åºåˆ—è½¬æ¢æ¨¡å‹ç”¨ç¼–è§£ç çš„æ¶æ„ã€‚è¿™é‡Œï¼Œç¼–ç å™¨æ˜ å°„ç”±(<code>$x_1,...,x_n$</code>)è¡¨ç¤ºçš„è¾“å…¥åºåˆ—åˆ°ç”± <code>$z=(z_1,...,z_n)$</code> è¡¨ç¤ºçš„è¿ç»­åºåˆ—ï¼Œç„¶åè§£ç å™¨ä¸€æ¬¡ç”Ÿæˆä¸€ä¸ªç”±<code>$(y_1,...,y_m)$</code>è¡¨ç¤ºçš„è¾“å‡ºåºåˆ—ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚æ¯ä¸€æ­¥æ¨¡å‹æ˜¯è‡ªåŠ¨å›å½’çš„ï¼Œå½“ç”Ÿæˆä¸‹ä¸€ä¸ªæ—¶ç”¨å…ˆå‰ç”Ÿæˆçš„ç‰¹å¾ä½œä¸ºåŠ æ€§è¾“å…¥ã€‚</p><blockquote><p>The Transformer follows this overall architecture using stacked self-attention and point-wise, fully connected layers for both the encoder and decoder, shown in the left and right halves of Figure 1, respectively.</p></blockquote><p>Transformeréµå¾ªä½¿ç”¨è‡ªæ³¨æ„åŠ›å †å å’Œæ•´ä½“æ¶æ„å’Œé€ç‚¹å…¨è¿æ¥å±‚çš„ç¼–ç å™¨å’Œè§£ç å™¨çš„æ•´ä½“æ¶æ„ï¼Œåˆ†åˆ«å±•ç¤ºåœ¨Figue 1çš„å·¦å³ä¸¤éƒ¨åˆ†ã€‚</p><p><img src="https://bbs-img-cbc-cn.obs.cn-north-1.myhuaweicloud.com/data/attachment/forum/202101/01/215059a5naotj646bx1pel.png" alt="Figure1"></p><h3 id="3-1Encoder-and-Decoder-Stacks"><a href="#3-1Encoder-and-Decoder-Stacks" class="headerlink" title="3.1Encoder and Decoder Stacks"></a>3.1Encoder and Decoder Stacks</h3><blockquote><p><strong>Encoder</strong>: The encoder is composed of a stack of <code>$N = 6$</code> identical layers. Each layer has two sub-layers. The first is a multi-head self-attention mechanism, and the second is a simple, position-wise fully connected feed-forward network. We employ a residual connection around each of the two sub-layers, followed by layer normalization. That is, the output of each sub-layer is <code>$LayerNorm(x + Sublayer(x))$</code> , where <code>$Sublayer(x)$</code> is the function implemented by the sub-layer itself. To facilitate these residual connections, all sub-layers in the model, as well as the embedding layers, produce outputs of dimension <code>$d_&#123;model&#125; = 512$</code> .</p></blockquote><p><strong>ç¼–ç å™¨</strong>ï¼šç¼–ç å™¨ç”±<code>$N = 6$</code>å®Œå…¨ä¸€æ ·çš„å±‚çš„æ ˆæ„æˆçš„ã€‚æ¯ä¸€å±‚æœ‰ä¸¤ä¸ªå­å±‚ã€‚ç¬¬ä¸€å±‚æ˜¯å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œç¬¬äºŒå±‚æ˜¯ä¸€ä¸ªç®€å•çš„æŒ‰ä½ç½®å…¨è¿æ¥çš„å‰é¦ˆç½‘ç»œã€‚æˆ‘ä»¬åœ¨ä¸¤ä¸ªå­å±‚çš„æ¯ä¸€å±‚å‘¨å›´ç”¨äº†æ®‹å·®è¿æ¥ï¼Œæ¥ç€å±‚å½’ä¸€åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€ä¸ªå­å±‚çš„è¾“å‡ºæ˜¯<code>$LayerNorm(x + Sublayer(x))$</code>ï¼Œè¿™é‡Œçš„<code>$Sublayer(x)$</code>æ˜¯å­å±‚æœ¬èº«å®ç°çš„å‡½æ•°ã€‚ä¸ºäº†æ–¹ä¾¿è¿™äº›æ®‹å·®è¿æ¥ï¼Œæ‰€æœ‰æ¨¡å‹çš„å­å±‚è¿˜æœ‰åµŒå…¥å±‚çš„è¾“å‡ºç»´åº¦æ˜¯<code>$d_&#123;model&#125; = 512$</code>ã€‚</p><blockquote><p><strong>Decoder</strong>: The decoder is also composed of a stack of <code>$N = 6$</code> identical layers. In addition to the two sub-layers in each encoder layer, the decoder inserts a third sub-layer, which performs multi-head attention over the output of the encoder stack. Similar to the encoder, we employ residual connections around each of the sub-layers, followed by layer normalization. We also modify the self-attention sub-layer in the decoder stack to prevent positions from attending to subsequent positions. This masking, combined with fact that the output embeddings are offset by one position, ensures that the predictions for position <code>$i$</code> can depend only on the known outputs at positions less than <code>$i$</code>.</p></blockquote><p><strong>è§£ç å™¨</strong>ï¼šè§£ç å™¨ä¹Ÿæ˜¯ç”±<code>$N = 6$</code>å®Œå…¨ä¸€æ ·çš„å±‚çš„æ ˆæ„æˆçš„ã€‚é™¤äº†åœ¨æ¯ä¸ªç¼–ç å™¨å±‚çš„ä¸¤ä¸ªå­å±‚ï¼Œè§£ç å™¨æ’å…¥äº†ç¬¬ä¸‰ä¸ªå­å±‚ï¼Œä»–å¯¹ç¼–ç å™¨æ ˆçš„è¾“å‡ºåšå¤šå¤´æ³¨æ„åŠ›ã€‚è·Ÿç¼–ç å™¨ç›¸ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨æ¯ä¸ªå­å±‚å‘¨å›´ç”¨æ®‹å·®è¿æ¥ï¼Œæ¥ç€å±‚å½’ä¸€åŒ–ã€‚æˆ‘ä»¬ä¹Ÿä¿®æ”¹äº†è§£ç å™¨æ ˆçš„è‡ªæ³¨æ„å­å±‚æ¥é˜²æ­¢ä½ç½®å…³æ³¨åˆ°åç»­ä½ç½®ã€‚è¿™æ ·æ©è”½(Mask)ï¼Œä¸è¾“å‡ºåµŒå…¥è¢«ä¸€ä¸ªä½ç½®åç§»ç»“åˆï¼Œç¡®ä¿å¯¹ä½ç½®<code>$i$</code>çš„é¢„æµ‹åªèƒ½ä¾èµ–ä½ç½®å°äº<code>$i$</code>çš„å·²çŸ¥è¾“å‡ºã€‚</p><h3 id="3-2-Attention"><a href="#3-2-Attention" class="headerlink" title="3.2 Attention"></a>3.2 Attention</h3><blockquote><p>An attention function can be described as mapping a query and a set of key-value pairs to an output, where the query, keys, values, and output are all vectors. The output is computed as a weighted sum of the values, where the weight assigned to each value is computed by a compatibility function of the query with the corresponding key.</p></blockquote><p>æ³¨æ„åŠ›å‡½æ•°å¯ä»¥è¢«æè¿°æˆæ˜ å°„ä¸€ä¸ªæŸ¥è¯¢(<code>$Q$</code>)å’Œä¸€ç»„é”®å€¼å¯¹(<code>$K:V$</code>)åˆ°ä¸€ä¸ªè¾“å‡ºï¼Œè¿™é‡Œçš„<code>$Q$</code>,<code>$K$</code>,<code>$V$</code>éƒ½æ˜¯å‘é‡ã€‚è¾“å‡ºæ˜¯<code>$V$</code>åŠ æƒæ±‚å’Œè®¡ç®—å¾—åˆ°çš„ï¼Œåˆ†é…ç»™æ¯ä¸ª<code>$V$</code>çš„æƒé‡æ˜¯ç”±æŸ¥è¯¢<code>$Q$</code>å’Œç›¸åº”çš„é”®<code>$K$</code>çš„ä¸€ä¸ªç›¸ä¼¼æ€§å‡½æ•°è®¡ç®—å¾—åˆ°çš„ã€‚</p><p><img src="https://pic4.zhimg.com/v2-3423dd5e8ac178dd303f3e52b32b8d56_r.jpg" alt="Figure 2"></p><h4 id="3-2-1-Scaled-Dot-Product-Attention"><a href="#3-2-1-Scaled-Dot-Product-Attention" class="headerlink" title="3.2.1 Scaled Dot-Product Attention"></a>3.2.1 Scaled Dot-Product Attention</h4><blockquote><p>We call our particular attention â€œScaled Dot-Product Attentionâ€ (Figure 2). The input consists of queries and keys of dimension <code>$d_k$</code> , and values of dimension <code>$d_v$</code> . We compute the dot products of the query with all keys, divide each by <code>$\sqrt&#123;d_k&#125;$</code> , and apply a softmax function to obtain the weights on the values.</p></blockquote><p>æˆ‘ä»¬æŠŠæˆ‘ä»¬ç‰¹åˆ«çš„æ³¨æ„åŠ›ç§°ä¸ºâ€œç¼©æ”¾çš„ç‚¹ç§¯æ³¨æ„åŠ›â€ï¼ˆå›¾2ï¼‰ã€‚è¾“å…¥æ˜¯ç”± <code>$q$</code>å’Œ<code>$d_k$</code> ç»´çš„<code>$k$</code>ä»¥åŠ<code>$d_v$</code>çš„<code>$v$</code>æ„æˆçš„ã€‚æˆ‘ä»¬è®¡ç®—<code>$q$</code>å’Œæ‰€æœ‰<code>$k$</code>çš„ç‚¹ç§¯ï¼Œæ¯ä¸€ä¸ªé™¤ä»¥<code>$\sqrt&#123;d_k&#125;$</code>ï¼Œç„¶åç”¨ä¸€ä¸ªsoftmaxå‡½æ•°æ¥è·å¾—ä¸åŒ<code>$v$</code>çš„æƒé‡ã€‚</p><blockquote><p>In practice, we compute the attention function on a set of queries simultaneously, packed together into a matrix $Q$ . The keys and values are also packed together into matrices <code>$K$</code> and <code>$V$</code> . We compute the matrix of outputs as:</p></blockquote><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬æ˜¯æŠŠä¸€ç»„<code>$q$</code>æ‰“åŒ…æˆä¸€ä¸ªçŸ©é˜µ<code>$Q$</code>åŒæ—¶è®¡ç®—æ³¨æ„åŠ›å‡½æ•°ã€‚<code>$k$</code>å’Œ<code>$v$</code>ä¹Ÿæ˜¯ä¸€èµ·è¢«æ‰“åŒ…è¿›çŸ©é˜µ<code>$K$</code>å’Œ<code>$V$</code>ã€‚æˆ‘ä»¬è®¡ç®—è¾“å‡ºçŸ©é˜µå¦‚ä¸‹ï¼š</p><p>$$<br>Attention(Q,K,V)&#x3D;softmax(\frac{QK^T}{\sqrt{d_k}}V)<br>$$</p><blockquote><p>The two most commonly used attention functions are additive attention, and dot-product (multi-plicative) attention. Dot-product attention is identical to our algorithm, except for the scaling factor of <code>$\frac&#123;1&#125;&#123;\sqrt&#123;d_k&#125;&#125;$</code>. Additive attention computes the compatibility function using a feed-forward network with a single hidden layer. While the two are similar in theoretical complexity, dot-product attention is much faster and more space-efficient in practice, since it can be implemented using highly optimized matrix multiplication code.</p></blockquote><p>ä¸¤ç§æœ€å¸¸ç”¨çš„æ³¨æ„åŠ›å‡½æ•°æ˜¯åŠ æ€§æ³¨æ„åŠ›å’Œä¹˜æ€§(ç‚¹ç§¯)æ³¨æ„åŠ›ã€‚ç‚¹ç§¯çš„æ³¨æ„åŠ›å’Œæˆ‘ä»¬çš„ç®—æ³•é™¤äº† <code>$\frac&#123;1&#125;&#123; \sqrt&#123;d_k&#125; &#125;$</code> è¿™ä¸ªç¼©æ”¾å› å­æ˜¯ä¸€æ ·çš„ã€‚åŠ æ€§æ³¨æ„åŠ›ç”¨ä¸€ä¸ªå•ä¸€éšè—å±‚çš„å‰é¦ˆç½‘ç»œè®¡ç®—ç›¸ä¼¼å‡½æ•°ã€‚è™½ç„¶è¿™ä¸¤ç§ç®—æ³•åœ¨ç†è®ºä¸Šçš„å¤æ‚æ€§æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯å®è·µä¸­ç‚¹ç§¯æ³¨æ„åŠ›æ›´å¿«ï¼Œæ›´çœç©ºé—´ï¼Œå› ä¸ºä»–å¯ä»¥ç”¨é«˜åº¦ä¼˜åŒ–çš„çŸ©é˜µä¹˜æ³•ä»£ç å®ç°ã€‚</p><blockquote><p>While for small values of <code>$d_k$</code> the two mechanisms perform similarly, additive attention outperforms dot product attention without scaling for larger values of <code>$d_k$</code>. We suspect that for large values of <code>$d_k$</code> , the dot products grow large in magnitude, pushing the softmax function into regions where it has extremely small gradients. To counteract this effect, we scale the dot products by <code>$\frac&#123;1&#125;&#123;\sqrt&#123;d_k&#125;&#125;$</code> .</p></blockquote><p>ç„¶è€Œå¯¹äºå°çš„<code>$d_k$</code>ä¸¤ç§æœºåˆ¶è¡¨ç°å·®ä¸å¤šï¼Œå¯¹äºæ›´å¤§çš„<code>$d_k$</code>åŠ æ€§æ³¨æ„åŠ›ä¼˜äºä¸å¸¦ç¼©æ”¾çš„ç‚¹ç§¯æ³¨æ„åŠ›ã€‚æˆ‘ä»¬çŒœæƒ³å¯¹äºå¤§çš„<code>$d_k$</code>ç‚¹ç§¯å˜çš„å¾ˆå¤§ï¼Œä½¿softmaxè¿›å…¥æ¢¯åº¦éå¸¸å°çš„åŒºåŸŸã€‚ä¸ºäº†æŠµæ¶ˆè¿™ç§æ•ˆåº”ï¼Œæˆ‘ä»¬æŠŠç‚¹ç§¯ç¼©å°äº† <code>$\frac&#123;1&#125;&#123;\sqrt&#123;d_k&#125;&#125;$</code> ã€‚</p><h4 id="3-2-2-Multi-Head-Attention"><a href="#3-2-2-Multi-Head-Attention" class="headerlink" title="3.2.2 Multi-Head Attention"></a>3.2.2 Multi-Head Attention</h4><blockquote><p>Instead of performing a single attention function with <code>$d_&#123;model&#125;$</code>-dimensional keys, values and queries, we found it beneficial to linearly project the queries, keys and values <code>$h$</code> times with different, learned linear projections to <code>$d_k$</code> , <code>$d_k$</code> and <code>$d_v$</code> dimensions, respectively. On each of these projected versions of queries, keys and values we then perform the attention function in parallel, yielding  <code>$d_v$</code> -dimensional output values. These are concatenated and once again projected, resulting in the final values.</p></blockquote><p>ä¸ç”¨<code>$d_&#123;model&#125;$</code>ç»´çš„<code>$k,vå’Œq$</code>æ‰§è¡Œå•ä¸€æ³¨æ„åŠ›å‡½æ•°ä¸åŒï¼Œæˆ‘ä»¬å‘ç°ç”¨åˆ†åˆ«åˆ°<code>$d_k$</code> , <code>$d_k$</code> å’Œ <code>$d_v$</code>ä¸åŒçš„å­¦ä¹ åˆ°çš„çº¿æ€§æ˜ å°„å¯¹çº¿æ€§æ˜ å°„<code>$q,k,v$</code>hæ¬¡æ˜¯æœ‰ç›Šçš„(ç»“åˆå›¾ç‰‡çœ‹ï¼‰ã€‚å¯¹è¿™äº›<code>$q,k,v$</code>çš„æ¯ä¸€ä¸ªæŠ•å½±ç‰ˆæˆ‘ä»¬æ¥ç€å¹¶è¡Œåœ°æ‰§è¡Œæ³¨æ„åŠ›å‡½æ•°ï¼Œç”Ÿæˆä¸€äº›<code>$d_v$</code>ç»´çš„è¾“å‡ºã€‚æŠŠè¿™äº›è¾“å‡ºè¿æ¥èµ·æ¥å†æ¬¡æ˜ å°„ç”Ÿæˆæœ€ç»ˆçš„ç»“æœã€‚</p><blockquote><p>Multi-head attention allows the model to jointly attend to information from different representation subspaces at different positions. With a single attention head, averaging inhibits this.</p></blockquote><p>å¤šå¤´æ³¨æ„åŠ›è®©æ¨¡å‹å…±åŒå…³æ³¨æ¥è‡ªä¸åŒçš„åœ¨ä¸åŒä½ç½®çš„å­ç©ºé—´ç‰¹å¾ã€‚ç”¨ä¸€ä¸ªæ³¨æ„åŠ›å¤´å¹³å‡æŠ‘åˆ¶äº†è¿™ä¸€ç‚¹ã€‚</p><p>$$<br>MultiHead(Q,K,V) &#x3D; Concat(head_1 ,â€¦,head_h )W^O<br>$$<br>$$<br>where\ head_i &#x3D; Attention(QW_i^Q,KW_i^K,VW^V_i)<br>$$</p><blockquote><p>Where the projections are parameter matrices <code>$W_i^Q\in R^&#123;d_&#123;model&#125;\times d_k&#125;$</code> , <code>$W_i^K \in R^&#123;d_&#123;model&#125; \times d_k&#125;$</code> , <code>$W_i^V \in R^&#123;d_&#123;model&#125; \times d_v&#125;$</code>and <code>$W^O \in R^&#123;hd_v \times d_&#123;model&#125;&#125;$</code> .</p></blockquote><blockquote><p>In this work we employ <code>$h = 8$</code> parallel attention layers, or heads. For each of these we use <code>$d_k = d_v = d_&#123;model&#125;/h = 64$</code> . Due to the reduced dimension of each head, the total computational cost is similar to that of single-head attention with full dimensionality.</p></blockquote><p>åœ¨è¿™æ¬¡å·¥ä½œä¸­æˆ‘ä»¬é‡‡ç”¨äº† <code>$h=8$</code> å¹¶è¡Œæ³¨æ„åŠ›å±‚ï¼ˆå¤´ï¼‰ã€‚å¯¹è¿™äº›ä¸­çš„æ¯ä¸€ä¸ªæˆ‘ä»¬ç”¨ <code>$d_k = d_v = d_&#123;model&#125;/h = 64$</code> ã€‚ç”±äºå‡å°äº†æ¯ä¸ªå¤´çš„ç»´åº¦ï¼Œæ€»è®¡ç®—é‡å’Œå•å¤´å…¨ç»´åº¦çš„æ³¨æ„åŠ›ç›¸è¿‘ã€‚</p><h4 id="3-2-3-Applications-of-Attention-in-our-Model"><a href="#3-2-3-Applications-of-Attention-in-our-Model" class="headerlink" title="3.2.3 Applications of Attention in our Model"></a>3.2.3 Applications of Attention in our Model</h4><blockquote><p>The Transformer uses multi-head attention in three different ways:</p></blockquote><p>Transformer ä»¥ä¸‰ç§ä¸åŒçš„æ–¹å¼ä½¿ç”¨å¤šå¤´æ³¨æ„åŠ›ã€‚</p><blockquote><ul><li>In â€œencoder-decoder attentionâ€ layers, the queries come from the previous decoder layer, and the memory keys and values come from the output of the encoder. This allows every position in the decoder to attend over all positions in the input sequence. This mimics the typical encoder-decoder attention mechanisms in sequence-to-sequence models.</li></ul></blockquote><ul><li>åœ¨â€encoder-decoder attentionâ€å±‚ï¼ŒæŸ¥è¯¢å€¼æ¥è‡ªå…ˆå‰çš„è§£ç å±‚ï¼Œå­˜å‚¨çš„é”®å€¼å¯¹æ¥è‡ªç¼–ç å™¨çš„è¾“å‡ºã€‚è¿™è®©è§£ç å™¨çš„æ¯ä¸ªä½ç½®å…³æ³¨è¾“å…¥åºåˆ—çš„å…¨éƒ¨ä½ç½®ã€‚è¿™æ¨¡ä»¿äº†åœ¨ sequence-to-sequenceæ¨¡å‹ä¸­å…¸å‹çš„ç¼–è§£ç æ³¨æ„åŠ›æœºåˆ¶ã€‚</li></ul><blockquote><ul><li>The encoder contains self-attention layers. In a self-attention layer all of the keys, values and queries come from the same place, in this case, the output of the previous layer in the encoder. Each position in the encoder can attend to all positions in the previous layer of the encoder.</li></ul></blockquote><ul><li>ç¼–ç å™¨åŒ…å«è‡ªæ³¨æ„åŠ›å±‚ã€‚åœ¨è‡ªæ³¨æ„åŠ›å±‚ä¸­æ‰€æœ‰çš„é”®å€¼å’ŒæŸ¥è¯¢åœ¨è¿™ç§æƒ…å†µä¸‹éƒ½æ¥è‡ªç›¸åŒçš„åœ°æ–¹â€”â€”ç¼–ç å™¨çš„å‰å±‚çš„è¾“å‡ºã€‚</li></ul><blockquote><ul><li>Similarly, self-attention layers in the decoder allow each position in the decoder to attend to all positions in the decoder up to and including that position. We need to prevent leftward information flow in the decoder to preserve the auto-regressive property. We implement this inside of scaled dot-product attention by masking out (setting to âˆ’âˆ ) all values in the input of the softmax which correspond to illegal connections. See Figure 2.</li></ul></blockquote><ul><li>ç±»ä¼¼çš„ï¼Œåœ¨è§£ç å™¨çš„è‡ªæ³¨æ„åŠ›å±‚è®©è§£ç å™¨çš„æ¯ä¸ªä½ç½®å…³æ³¨åˆ°è§£ç å™¨çš„æ‰€æœ‰ä½ç½®åŒ…æ‹¬é‚£ä¸ªä½ç½®ã€‚æˆ‘ä»¬éœ€è¦é˜»æ­¢å·¦è¾¹çš„ä¿¡æ¯æµå…¥åˆ°è§£ç å™¨æ¥ç»´æŒè‡ªå›å½’çš„ç‰¹æ€§ã€‚æˆ‘ä»¬é€šè¿‡é®ç›–ï¼ˆè®¾ç½®ä¸º-âˆï¼‰å¯¹åº”ä¸åˆç†è¿æ¥çš„softmaxè¾“å…¥çš„æ‰€æœ‰å€¼ï¼Œåœ¨ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ä¸­å®ç°è¿™ä¸€ç‚¹ã€‚</li></ul><h3 id="3-3-Position-wise-Feed-Forward-Networks"><a href="#3-3-Position-wise-Feed-Forward-Networks" class="headerlink" title="3.3 Position-wise Feed-Forward Networks"></a>3.3 Position-wise Feed-Forward Networks</h3><blockquote><p>In addition to attention sub-layers, each of the layers in our encoder and decoder contains a fully connected feed-forward network, which is applied to each position separately and identically. This consists of two linear transformations with a ReLU activation in between.<br>$$<br>FFN(x) &#x3D; max(0,xW_1 + b_1)W_2 + b_2<br>$$<br>While the linear transformations are the same across different positions, they use different parameters from layer to layer. Another way of describing this is as two convolutions with kernel size 1. The dimensionality of input and output is <code>$d_&#123;model&#125; = 512$</code>, and the inner-layer has dimensionality<br><code>$d_&#123;ff&#125;$</code> &#x3D; 2048.</p></blockquote><h3 id="3-4-Embeddings-and-Softmax"><a href="#3-4-Embeddings-and-Softmax" class="headerlink" title="3.4 Embeddings and Softmax"></a>3.4 Embeddings and Softmax</h3><blockquote><p>Similarly to other sequence transduction models, we use learned embeddings to convert the input tokens and output tokens to vectors of dimension <code>$d_&#123;model&#125;$</code> . We also use the usual learned linear transfor-mation and softmax function to convert the decoder output to predicted next-token probabilities. In our model, we share the same weight matrix between the two embedding layers and the pre-softmax linear transformation, similar to [ 30 ]. In the embedding layers, we multiply those weights by <code>$\sqrt&#123;d_&#123;model&#125;&#125;$</code> model .</p></blockquote><h3 id="3-5-Positional-Encoding"><a href="#3-5-Positional-Encoding" class="headerlink" title="3.5 Positional Encoding"></a>3.5 Positional Encoding</h3><blockquote><p>Since our model contains no recurrence and no convolution, in order for the model to make use of the order of the sequence, we must inject some information about the relative or absolute position of the tokens in the sequence. To this end, we add â€œpositional encodingsâ€ to the input embeddings at the bottoms of the encoder and decoder stacks. The positional encodings have the same dimension d model as the embeddings, so that the two can be summed. There are many choices of positional encodings, learned and fixed.</p></blockquote><blockquote><p>In this work, we use sine and cosine functions of different frequencies:<br>$$<br>PE(pos,2i) &#x3D; sin(pos&#x2F;10000^{2i&#x2F;d_{model}})<br>$$<br>$$<br>PE(pos,2i+1) &#x3D; cos(pos&#x2F;10000^{2i&#x2F;d_{model}})<br>$$<br>where <code>$pos$</code> is the position and <code>$i$</code> is the dimension. That is, each dimension of the positional encoding corresponds to a sinusoid. The wavelengths form a geometric progression from 2Ï€ to 10000Â·2Ï€ . We chose this function because we hypothesized it would allow the model to easily learn to attend by relative positions, since for any fixed offset <code>$k$</code>,  <code>$PE_&#123;pos&#125;+k$</code> can be represented as a linear function of <code>$PE_&#123;pos&#125;$</code> .</p></blockquote><blockquote><p>We also experimented with using learned positional embeddings instead, and found that the two versions produced nearly identical results (see Table 3 row (E)). We chose the sinusoidal version because it may allow the model to extrapolate to sequence lengths longer than the ones encountered during training.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>è®ºæ–‡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nlp</tag>
      
      <tag>æ·±åº¦å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…è´¹éƒ¨ç½²ChatGPT4ç­‰å›½å†…å¯è®¿é—®ç½‘ç«™</title>
    <link href="/posts/1cd5914f/"/>
    <url>/posts/1cd5914f/</url>
    
    <content type="html"><![CDATA[<p>ç®€å•å‡ æ­¥ <strong>å…è´¹ç™½å«–</strong> éƒ¨ç½² <strong>å›½å†…åœ¨çº¿è®¿é—®</strong> çš„ <strong>ChatGPT3.5&#x2F;4</strong> ç½‘ç«™</p><span id="more"></span><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ol><li>å¯è®¿é—®å¤–ç½‘çš„å·¥å…·ï¼ˆæ²¡æœ‰çš„è¯å¯ä»¥èµ°äº†</li><li><code>GitHub</code>è´¦å·</li><li><code>DisCord</code>è´¦å·</li></ol><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ol><li><p><code>fork</code> <a href="https://github.com/hihumanzone/fgpt">å¤§ä½¬çš„é¡¹ç›®</a> åˆ°è‡ªå·±è´¦å·<br><img src="https://i.imgtg.com/2023/07/19/OFvudL.png"></p></li><li><p><code>æ³¨å†Œå¹¶ç™»å½•</code> <a href="https://zeabur.com/zh-CN">éƒ¨ç½²å¹³å°zeabur</a>ï¼Œåˆ›å»ºæ–°é¡¹ç›®ç„¶åå·´æ‹‰å·´æ‹‰ï¼Œå¾ˆç®€å•å°±ä¸èµ˜è¿°äº†ï¼Œ <a href="https://zeabur.com/docs/zh-CN">ä½¿ç”¨æ–‡æ¡£</a> åœ¨è¿™ã€‚<img src="https://zeabur.com/docs/_next/image?url=/docs/_next/static/media/deploy-service-screenshot.81e02f55.png&w=3840&q=75"> æ³¨æ„è¿™é‡Œé€‰æ‹©GitHub,éªŒè¯å®Œå<code>æœç´¢fgpt</code>é€‰æ‹©åˆšæ‰forkçš„é¡¹ç›®ã€‚</p></li><li><p>éƒ¨ç½²è®¾ç½®æ–‡æ¡£é‡Œæœ‰è¯¦ç»†è¯´æ˜ã€‚åŸŸåå¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚å¦‚å›¾è¿™é‡Œéœ€è¦æ·»åŠ ä¸€ä¸ªå˜é‡ <code>OPENAI_API_HOST</code> <strong>:</strong> <code> https://chimeragpt.adventblocks.cc</code> <img src="https://i.imgtg.com/2023/07/19/OFyaFj.png"> ç‚¹å‡»éƒ¨ç½²åç½‘ç«™åˆ°æ­¤å°±éƒ¨ç½²å®Œæˆäº†ã€‚</p></li><li><p>æƒ³è¦æ­£å¸¸ä½¿ç”¨è¿˜å¾—å¡«å†™è¿™é‡Œçš„ <code>OpenAI API Key</code> <img src="https://i.imgtg.com/2023/07/19/OFyUsq.png"></p></li></ol><ul><li>è·å–æ–¹æ³• <a href="https://discord.com/invite/t9QvFvzkmV">ç‚¹å‡»åŠ å…¥æ­¤DisCordé¢‘é“</a></li><li>å…ˆå»è¿™é‡ŒéªŒè¯ï¼ˆç‚¹å‡»éªŒè¯åä¾æ¬¡è¾“å…¥å›¾ä¸­é«˜äº®å­—ç¬¦ï¼‰ <img src="https://i.imgtg.com/2023/07/19/OFybac.png"> </li><li>ç„¶ååœ¨å·¦è¾¹é€‰æ‹©botï¼Œå³ä¾§è¾“å…¥<code>/key get</code><img src="https://i.imgtg.com/2023/07/19/OFyxGM.png"></li><li>æŠŠè¿”å›çš„keyå¡«å…¥ç½‘ç«™ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼ğŸ¤©</li></ul><p>æˆæœå¦‚å›¾ï¼Œå¥½å¤šæ¨¡å‹å•Š (â˜… Ï‰ â˜…)!<br><img src="https://i.imgtg.com/2023/07/19/OFyzIG.png"></p><p>End</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•™ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>joystick</title>
    <link href="/posts/fc43ded0/"/>
    <url>/posts/fc43ded0/</url>
    
    <content type="html"><![CDATA[<p><strong>å®‰å“æ¨¡æ‹Ÿæ¸¸æˆæ‘‡æ†ï¼Œå­¦ä¹ androidå®ç°è‡ªå®šä¹‰view</strong></p><span id="more"></span><p>å‚è€ƒæ–‡ç« :<a href="https://www.jianshu.com/p/96c982d41623">https://www.jianshu.com/p/96c982d41623</a> ï¼ŒåŸæ–‡éƒ¨åˆ†å†…å®¹ä¸å…¨ã€‚</p><p><code>attrs.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">declare-styleable</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RockerView&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;areaBackground&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;color|reference&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rockerBackground&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;color|reference&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rockerRadius&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;dimension&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rockerScale&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;float&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rockerSpeedLevel&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;dimension&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rockerCallBackMode&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;dimension&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">declare-styleable</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>RockerView.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.content.res.TypedArray;<br><span class="hljs-keyword">import</span> android.graphics.Bitmap;<br><span class="hljs-keyword">import</span> android.graphics.Canvas;<br><span class="hljs-keyword">import</span> android.graphics.Color;<br><span class="hljs-keyword">import</span> android.graphics.Paint;<br><span class="hljs-keyword">import</span> android.graphics.PixelFormat;<br><span class="hljs-keyword">import</span> android.graphics.Point;<br><span class="hljs-keyword">import</span> android.graphics.Rect;<br><span class="hljs-keyword">import</span> android.graphics.drawable.BitmapDrawable;<br><span class="hljs-keyword">import</span> android.graphics.drawable.ColorDrawable;<br><span class="hljs-keyword">import</span> android.graphics.drawable.Drawable;<br><span class="hljs-keyword">import</span> android.graphics.drawable.GradientDrawable;<br><span class="hljs-keyword">import</span> android.util.AttributeSet;<br><span class="hljs-keyword">import</span> android.util.Log;<br><span class="hljs-keyword">import</span> android.view.MotionEvent;<br><span class="hljs-keyword">import</span> android.view.View;<br><br><span class="hljs-keyword">import</span> com.zony.hello.R;<br><br><span class="hljs-keyword">import</span> java.util.logging.Level;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by jinkia on 2016/9/30.</span><br><span class="hljs-comment"> * æ‘‡æ†æ§ä»¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RockerView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RockerView&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">400</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">DEFAULT_ROCKER_SCALE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.5f</span>;<span class="hljs-comment">//é»˜è®¤åŠå¾„ä¸ºèƒŒæ™¯çš„1/2</span><br><br>    <span class="hljs-keyword">private</span> Paint mAreaBackgroundPaint;<br>    <span class="hljs-keyword">private</span> Paint mRockerPaint;<br><br>    <span class="hljs-keyword">private</span> Point mRockerPosition;<br>    <span class="hljs-keyword">private</span> Point mCenterPoint;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mAreaRadius;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> mRockerScale;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mRockerRadius;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">CallBackMode</span> <span class="hljs-variable">mCallBackMode</span> <span class="hljs-operator">=</span> CallBackMode.CALL_BACK_MODE_MOVE;<br>    <span class="hljs-keyword">private</span> OnAngleChangeListener mOnAngleChangeListener;<br>    <span class="hljs-keyword">private</span> OnShakeListener mOnShakeListener;<br>    <span class="hljs-keyword">private</span> OnDistanceLevelListener mOnDistanceLevelListener;<br><br>    <span class="hljs-keyword">private</span> DirectionMode mDirectionMode;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Direction</span> <span class="hljs-variable">tempDirection</span> <span class="hljs-operator">=</span> Direction.DIRECTION_CENTER;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">lastDistance</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasCall</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">baseDistance</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">mDistanceLevel</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<span class="hljs-comment">//åˆ†æˆ10åˆ†</span><br><br><br>    <span class="hljs-comment">// è§’åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_0</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_360</span> <span class="hljs-operator">=</span> <span class="hljs-number">360</span>;<br>    <span class="hljs-comment">// 360Â°æ°´å¹³æ–¹å‘å¹³åˆ†2ä»½çš„è¾¹ç¼˜è§’åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_HORIZONTAL_2D_OF_0P</span> <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_HORIZONTAL_2D_OF_1P</span> <span class="hljs-operator">=</span> <span class="hljs-number">270</span>;<br>    <span class="hljs-comment">// 360Â°å‚ç›´æ–¹å‘å¹³åˆ†2ä»½çš„è¾¹ç¼˜è§’åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_VERTICAL_2D_OF_0P</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_VERTICAL_2D_OF_1P</span> <span class="hljs-operator">=</span> <span class="hljs-number">180</span>;<br>    <span class="hljs-comment">// 360Â°å¹³åˆ†4ä»½çš„è¾¹ç¼˜è§’åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_4D_OF_0P</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_4D_OF_1P</span> <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_4D_OF_2P</span> <span class="hljs-operator">=</span> <span class="hljs-number">180</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_4D_OF_3P</span> <span class="hljs-operator">=</span> <span class="hljs-number">270</span>;<br>    <span class="hljs-comment">// 360Â°å¹³åˆ†4ä»½çš„è¾¹ç¼˜è§’åº¦(æ—‹è½¬45åº¦)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_ROTATE45_4D_OF_0P</span> <span class="hljs-operator">=</span> <span class="hljs-number">45</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_ROTATE45_4D_OF_1P</span> <span class="hljs-operator">=</span> <span class="hljs-number">135</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_ROTATE45_4D_OF_2P</span> <span class="hljs-operator">=</span> <span class="hljs-number">225</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_ROTATE45_4D_OF_3P</span> <span class="hljs-operator">=</span> <span class="hljs-number">315</span>;<br><br>    <span class="hljs-comment">// 360Â°å¹³åˆ†8ä»½çš„è¾¹ç¼˜è§’åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_0P</span> <span class="hljs-operator">=</span> <span class="hljs-number">22.5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_1P</span> <span class="hljs-operator">=</span> <span class="hljs-number">67.5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_2P</span> <span class="hljs-operator">=</span> <span class="hljs-number">112.5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_3P</span> <span class="hljs-operator">=</span> <span class="hljs-number">157.5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_4P</span> <span class="hljs-operator">=</span> <span class="hljs-number">202.5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_5P</span> <span class="hljs-operator">=</span> <span class="hljs-number">247.5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_6P</span> <span class="hljs-operator">=</span> <span class="hljs-number">292.5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">ANGLE_8D_OF_7P</span> <span class="hljs-operator">=</span> <span class="hljs-number">337.5</span>;<br><br>    <span class="hljs-comment">// æ‘‡æ†å¯ç§»åŠ¨åŒºåŸŸèƒŒæ™¯</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">AREA_BACKGROUND_MODE_PIC</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">AREA_BACKGROUND_MODE_COLOR</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">AREA_BACKGROUND_MODE_XML</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">AREA_BACKGROUND_MODE_DEFAULT</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">mAreaBackgroundMode</span> <span class="hljs-operator">=</span> AREA_BACKGROUND_MODE_DEFAULT;<br>    <span class="hljs-keyword">private</span> Bitmap mAreaBitmap;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mAreaColor;<br>    <span class="hljs-comment">// æ‘‡æ†èƒŒæ™¯</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ROCKER_BACKGROUND_MODE_PIC</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ROCKER_BACKGROUND_MODE_COLOR</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ROCKER_BACKGROUND_MODE_XML</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ROCKER_BACKGROUND_MODE_DEFAULT</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">mRockerBackgroundMode</span> <span class="hljs-operator">=</span> ROCKER_BACKGROUND_MODE_DEFAULT;<br>    <span class="hljs-keyword">private</span> Bitmap mRockerBitmap;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mRockerColor;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RockerView</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs);<br><br>        <span class="hljs-comment">// è·å–è‡ªå®šä¹‰å±æ€§</span><br>        initAttribute(context, attrs);<br><br>        <span class="hljs-keyword">if</span> (isInEditMode()) &#123;<br>        &#125;<br><br>        <span class="hljs-comment">// ç§»åŠ¨åŒºåŸŸç”»ç¬”</span><br>        mAreaBackgroundPaint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>();<br>        mAreaBackgroundPaint.setAntiAlias(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">// æ‘‡æ†ç”»ç¬”</span><br>        mRockerPaint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>();<br>        mRockerPaint.setAntiAlias(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">// ä¸­å¿ƒç‚¹</span><br>        mCenterPoint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>();<br>        <span class="hljs-comment">// æ‘‡æ†ä½ç½®</span><br>        mRockerPosition = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–å±æ€§</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context context</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> attrs   attrs</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initAttribute</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> &#123;<br>        <span class="hljs-type">TypedArray</span> <span class="hljs-variable">typedArray</span> <span class="hljs-operator">=</span> context.obtainStyledAttributes(attrs, R.styleable.RockerView);<br><br>        <span class="hljs-comment">// å¯ç§»åŠ¨åŒºåŸŸèƒŒæ™¯</span><br>        <span class="hljs-type">Drawable</span> <span class="hljs-variable">areaBackground</span> <span class="hljs-operator">=</span> typedArray.getDrawable(R.styleable.RockerView_areaBackground);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != areaBackground) &#123;<br>            <span class="hljs-comment">// è®¾ç½®äº†èƒŒæ™¯</span><br>            <span class="hljs-keyword">if</span> (areaBackground <span class="hljs-keyword">instanceof</span> BitmapDrawable) &#123;<br>                <span class="hljs-comment">// è®¾ç½®äº†ä¸€å¼ å›¾ç‰‡</span><br>                mAreaBitmap = ((BitmapDrawable) areaBackground).getBitmap();<br>                mAreaBackgroundMode = AREA_BACKGROUND_MODE_PIC;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (areaBackground <span class="hljs-keyword">instanceof</span> GradientDrawable) &#123;<br>                <span class="hljs-comment">// XML</span><br>                mAreaBitmap = drawable2Bitmap(areaBackground);<br>                mAreaBackgroundMode = AREA_BACKGROUND_MODE_XML;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (areaBackground <span class="hljs-keyword">instanceof</span> ColorDrawable) &#123;<br>                <span class="hljs-comment">// è‰²å€¼</span><br>                mAreaColor = ((ColorDrawable) areaBackground).getColor();<br>                mAreaBackgroundMode = AREA_BACKGROUND_MODE_COLOR;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// å…¶ä»–å½¢å¼</span><br>                mAreaBackgroundMode = AREA_BACKGROUND_MODE_DEFAULT;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// æ²¡æœ‰è®¾ç½®èƒŒæ™¯</span><br>            mAreaBackgroundMode = AREA_BACKGROUND_MODE_DEFAULT;<br>        &#125;<br>        <span class="hljs-comment">// æ‘‡æ†èƒŒæ™¯</span><br>        <span class="hljs-type">Drawable</span> <span class="hljs-variable">rockerBackground</span> <span class="hljs-operator">=</span> typedArray.getDrawable(R.styleable.RockerView_rockerBackground);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != rockerBackground) &#123;<br>            <span class="hljs-comment">// è®¾ç½®äº†æ‘‡æ†èƒŒæ™¯</span><br>            <span class="hljs-keyword">if</span> (rockerBackground <span class="hljs-keyword">instanceof</span> BitmapDrawable) &#123;<br>                <span class="hljs-comment">// å›¾ç‰‡</span><br>                mRockerBitmap = ((BitmapDrawable) rockerBackground).getBitmap();<br>                mRockerBackgroundMode = ROCKER_BACKGROUND_MODE_PIC;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rockerBackground <span class="hljs-keyword">instanceof</span> GradientDrawable) &#123;<br>                <span class="hljs-comment">// XML</span><br>                mRockerBitmap = drawable2Bitmap(rockerBackground);<br>                mRockerBackgroundMode = ROCKER_BACKGROUND_MODE_XML;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rockerBackground <span class="hljs-keyword">instanceof</span> ColorDrawable) &#123;<br>                <span class="hljs-comment">// è‰²å€¼</span><br>                mRockerColor = ((ColorDrawable) rockerBackground).getColor();<br>                mRockerBackgroundMode = ROCKER_BACKGROUND_MODE_COLOR;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// å…¶ä»–å½¢å¼</span><br>                mRockerBackgroundMode = ROCKER_BACKGROUND_MODE_DEFAULT;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// æ²¡æœ‰è®¾ç½®æ‘‡æ†èƒŒæ™¯</span><br>            mRockerBackgroundMode = ROCKER_BACKGROUND_MODE_DEFAULT;<br>        &#125;<br><br>        <span class="hljs-comment">// æ‘‡æ†åŠå¾„</span><br>        mRockerScale = typedArray.getFloat(R.styleable.RockerView_rockerScale, DEFAULT_ROCKER_SCALE);<br>        <span class="hljs-comment">//è·ç¦»çº§åˆ«</span><br>        mDistanceLevel = typedArray.getInt(R.styleable.RockerView_rockerSpeedLevel, <span class="hljs-number">10</span>);<br>        <span class="hljs-comment">//å›è°ƒæ¨¡å¼</span><br>        mCallBackMode = getCallBackMode(typedArray.getInt(R.styleable.RockerView_rockerCallBackMode, <span class="hljs-number">0</span>));<br>        typedArray.recycle();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec, <span class="hljs-type">int</span> heightMeasureSpec)</span> &#123;<br>        <span class="hljs-type">int</span> measureWidth, measureHeight;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">widthMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(widthMeasureSpec);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">heightMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(heightMeasureSpec);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">widthSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(widthMeasureSpec);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">heightSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(heightMeasureSpec);<br><br>        <span class="hljs-keyword">if</span> (widthMode == MeasureSpec.EXACTLY) &#123;<br>            <span class="hljs-comment">// å…·ä½“çš„å€¼å’Œmatch_parent</span><br>            measureWidth = widthSize;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// wrap_content</span><br>            measureWidth = DEFAULT_SIZE;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (heightMode == MeasureSpec.EXACTLY) &#123;<br>            measureHeight = heightSize;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            measureHeight = DEFAULT_SIZE;<br>        &#125;<br>        setMeasuredDimension(measureWidth, measureHeight);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDraw(canvas);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">measuredWidth</span> <span class="hljs-operator">=</span> getMeasuredWidth();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">measuredHeight</span> <span class="hljs-operator">=</span> getMeasuredHeight();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">cx</span> <span class="hljs-operator">=</span> measuredWidth / <span class="hljs-number">2</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">cy</span> <span class="hljs-operator">=</span> measuredHeight / <span class="hljs-number">2</span>;<br><br>        <span class="hljs-comment">// ä¸­å¿ƒç‚¹</span><br>        mCenterPoint.set(cx, cy);<br>        <span class="hljs-comment">// å¯ç§»åŠ¨åŒºåŸŸçš„åŠå¾„</span><br>        mAreaRadius = (measuredWidth &lt;= measuredHeight) ? (<span class="hljs-type">int</span>) (cx / (mRockerScale + <span class="hljs-number">1</span>)) : (<span class="hljs-type">int</span>) (cy / (mRockerScale + <span class="hljs-number">1</span>));<br>        mRockerRadius = (<span class="hljs-type">int</span>) (mAreaRadius * mRockerScale);<br>        <span class="hljs-comment">// æ‘‡æ†ä½ç½®</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == mRockerPosition.x || <span class="hljs-number">0</span> == mRockerPosition.y) &#123;<br>            mRockerPosition.set(mCenterPoint.x, mCenterPoint.y);<br>        &#125;<br><br>        <span class="hljs-comment">// ç”»å¯ç§»åŠ¨åŒºåŸŸ</span><br>        <span class="hljs-keyword">if</span> (AREA_BACKGROUND_MODE_PIC == mAreaBackgroundMode || AREA_BACKGROUND_MODE_XML == mAreaBackgroundMode) &#123;<br>            <span class="hljs-comment">// å›¾ç‰‡</span><br>            <span class="hljs-type">Rect</span> <span class="hljs-variable">src</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, mAreaBitmap.getWidth(), mAreaBitmap.getHeight());<br>            <span class="hljs-type">Rect</span> <span class="hljs-variable">dst</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>(mCenterPoint.x - mAreaRadius, mCenterPoint.y - mAreaRadius, mCenterPoint.x + mAreaRadius, mCenterPoint.y + mAreaRadius);<br>            canvas.drawBitmap(mAreaBitmap, src, dst, mAreaBackgroundPaint);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (AREA_BACKGROUND_MODE_COLOR == mAreaBackgroundMode) &#123;<br>            <span class="hljs-comment">// è‰²å€¼</span><br>            mAreaBackgroundPaint.setColor(mAreaColor);<br>            canvas.drawCircle(mCenterPoint.x, mCenterPoint.y, mAreaRadius, mAreaBackgroundPaint);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å…¶ä»–æˆ–è€…æœªè®¾ç½®</span><br>            mAreaBackgroundPaint.setColor(Color.GRAY);<br>            canvas.drawCircle(mCenterPoint.x, mCenterPoint.y, mAreaRadius, mAreaBackgroundPaint);<br>        &#125;<br><br>        <span class="hljs-comment">// ç”»æ‘‡æ†</span><br>        <span class="hljs-keyword">if</span> (ROCKER_BACKGROUND_MODE_PIC == mRockerBackgroundMode || ROCKER_BACKGROUND_MODE_XML == mRockerBackgroundMode) &#123;<br>            <span class="hljs-comment">// å›¾ç‰‡</span><br>            <span class="hljs-type">Rect</span> <span class="hljs-variable">src</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, mRockerBitmap.getWidth(), mRockerBitmap.getHeight());<br>            <span class="hljs-type">Rect</span> <span class="hljs-variable">dst</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>(mRockerPosition.x - mRockerRadius, mRockerPosition.y - mRockerRadius, mRockerPosition.x + mRockerRadius, mRockerPosition.y + mRockerRadius);<br>            canvas.drawBitmap(mRockerBitmap, src, dst, mRockerPaint);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ROCKER_BACKGROUND_MODE_COLOR == mRockerBackgroundMode) &#123;<br>            <span class="hljs-comment">// è‰²å€¼</span><br>            mRockerPaint.setColor(mRockerColor);<br>            canvas.drawCircle(mRockerPosition.x, mRockerPosition.y, mRockerRadius, mRockerPaint);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å…¶ä»–æˆ–è€…æœªè®¾ç½®</span><br>            mRockerPaint.setColor(Color.RED);<br>            canvas.drawCircle(mRockerPosition.x, mRockerPosition.y, mRockerRadius, mRockerPaint);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (event.getAction()) &#123;<br>            <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN:<span class="hljs-comment">// æŒ‰ä¸‹</span><br>                <span class="hljs-comment">// å›è°ƒ å¼€å§‹</span><br>                callBackStart();<br>            <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE:<span class="hljs-comment">// ç§»åŠ¨</span><br>                <span class="hljs-type">float</span> <span class="hljs-variable">moveX</span> <span class="hljs-operator">=</span> event.getX();<br>                <span class="hljs-type">float</span> <span class="hljs-variable">moveY</span> <span class="hljs-operator">=</span> event.getY();<br>                baseDistance = mAreaRadius + <span class="hljs-number">2</span>;<br>                Log.d(<span class="hljs-string">&quot;baseDistance&quot;</span>, baseDistance + <span class="hljs-string">&quot;&quot;</span>);<br>                mRockerPosition = getRockerPositionPoint(mCenterPoint, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>((<span class="hljs-type">int</span>) moveX, (<span class="hljs-type">int</span>) moveY), mAreaRadius + mRockerRadius, mRockerRadius);<br>                moveRocker(mRockerPosition.x, mRockerPosition.y);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:<span class="hljs-comment">// æŠ¬èµ·</span><br>            <span class="hljs-keyword">case</span> MotionEvent.ACTION_CANCEL:<span class="hljs-comment">// ç§»å‡ºåŒºåŸŸ</span><br>                <span class="hljs-comment">// å›è°ƒ ç»“æŸ</span><br>                callBackFinish();<br>                <span class="hljs-keyword">if</span> (mOnShakeListener != <span class="hljs-literal">null</span>) &#123;<br>                    mOnShakeListener.direction(Direction.DIRECTION_CENTER);<br>                &#125;<br>                <span class="hljs-type">float</span> <span class="hljs-variable">upX</span> <span class="hljs-operator">=</span> event.getX();<br>                <span class="hljs-type">float</span> <span class="hljs-variable">upY</span> <span class="hljs-operator">=</span> event.getY();<br>                moveRocker(mCenterPoint.x, mCenterPoint.y);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–æ‘‡æ†å®é™…è¦æ˜¾ç¤ºçš„ä½ç½®ï¼ˆç‚¹ï¼‰</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> centerPoint  ä¸­å¿ƒç‚¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> touchPoint   è§¦æ‘¸ç‚¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> regionRadius æ‘‡æ†å¯æ´»åŠ¨åŒºåŸŸåŠå¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rockerRadius æ‘‡æ†åŠå¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ‘‡æ†å®é™…æ˜¾ç¤ºçš„ä½ç½®ï¼ˆç‚¹ï¼‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Point <span class="hljs-title function_">getRockerPositionPoint</span><span class="hljs-params">(Point centerPoint, Point touchPoint, <span class="hljs-type">float</span> regionRadius, <span class="hljs-type">float</span> rockerRadius)</span> &#123;<br>        <span class="hljs-comment">// ä¸¤ç‚¹åœ¨Xè½´çš„è·ç¦»</span><br>        <span class="hljs-type">float</span> <span class="hljs-variable">lenX</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) (touchPoint.x - centerPoint.x);<br>        <span class="hljs-comment">// ä¸¤ç‚¹åœ¨Yè½´è·ç¦»</span><br>        <span class="hljs-type">float</span> <span class="hljs-variable">lenY</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) (touchPoint.y - centerPoint.y);<br>        <span class="hljs-comment">// ä¸¤ç‚¹è·ç¦»</span><br>        <span class="hljs-type">float</span> <span class="hljs-variable">lenXY</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) Math.sqrt((<span class="hljs-type">double</span>) (lenX * lenX + lenY * lenY));<br>        <span class="hljs-comment">// è®¡ç®—å¼§åº¦</span><br>        <span class="hljs-type">double</span> <span class="hljs-variable">radian</span> <span class="hljs-operator">=</span> Math.acos(lenX / lenXY) * (touchPoint.y &lt; centerPoint.y ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// è®¡ç®—è§’åº¦</span><br>        <span class="hljs-type">double</span> <span class="hljs-variable">angle</span> <span class="hljs-operator">=</span> radian2Angle(radian);<br><br>        <span class="hljs-keyword">if</span> (lenXY + rockerRadius &lt;= regionRadius) &#123; <span class="hljs-comment">// è§¦æ‘¸ä½ç½®åœ¨å¯æ´»åŠ¨èŒƒå›´å†…</span><br>            <span class="hljs-comment">// å›è°ƒ è¿”å›å‚æ•°</span><br>            callBack(angle, (<span class="hljs-type">int</span>) lenXY);<br>            <span class="hljs-keyword">return</span> touchPoint;<br>        &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// è§¦æ‘¸ä½ç½®åœ¨å¯æ´»åŠ¨èŒƒå›´ä»¥å¤–</span><br>            <span class="hljs-comment">// è®¡ç®—è¦æ˜¾ç¤ºçš„ä½ç½®</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">showPointX</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (centerPoint.x + (regionRadius - rockerRadius) * Math.cos(radian));<br>            <span class="hljs-type">int</span> <span class="hljs-variable">showPointY</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (centerPoint.y + (regionRadius - rockerRadius) * Math.sin(radian));<br><br>            callBack(angle, (<span class="hljs-type">int</span>) Math.sqrt((showPointX - centerPoint.x) * (showPointX - centerPoint.x) + (showPointY - centerPoint.y) * (showPointY - centerPoint.y)));<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(showPointX, showPointY);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§»åŠ¨æ‘‡æ†åˆ°æŒ‡å®šä½ç½®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> x xåæ ‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> y yåæ ‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">moveRocker</span><span class="hljs-params">(<span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y)</span> &#123;<br>        mRockerPosition.set((<span class="hljs-type">int</span>) x, (<span class="hljs-type">int</span>) y);<br>        invalidate();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼§åº¦è½¬è§’åº¦</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> radian å¼§åº¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è§’åº¦[0, 360)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> <span class="hljs-title function_">radian2Angle</span><span class="hljs-params">(<span class="hljs-type">double</span> radian)</span> &#123;<br>        <span class="hljs-type">double</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> Math.round(radian / Math.PI * <span class="hljs-number">180</span>);<br>        <span class="hljs-keyword">return</span> tmp &gt;= <span class="hljs-number">0</span> ? tmp : <span class="hljs-number">360</span> + tmp;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Drawable è½¬ Bitmap</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> drawable Drawable</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Bitmap</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Bitmap <span class="hljs-title function_">drawable2Bitmap</span><span class="hljs-params">(Drawable drawable)</span> &#123;<br>        <span class="hljs-comment">// å– drawable çš„é•¿å®½</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> drawable.getIntrinsicWidth();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> drawable.getIntrinsicHeight();<br>        <span class="hljs-comment">// å– drawable çš„é¢œè‰²æ ¼å¼</span><br>        Bitmap.<span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> drawable.getOpacity() != PixelFormat.OPAQUE ? Bitmap.Config.ARGB_8888 : Bitmap.Config.RGB_565;<br>        <span class="hljs-comment">// å»ºç«‹å¯¹åº” bitmap</span><br>        <span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> Bitmap.createBitmap(width, height, config);<br>        <span class="hljs-type">Canvas</span> <span class="hljs-variable">canvas</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Canvas</span>(bitmap);<br>        drawable.setBounds(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);<br>        drawable.draw(canvas);<br>        <span class="hljs-keyword">return</span> bitmap;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å›è°ƒ</span><br><span class="hljs-comment">     * å¼€å§‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callBackStart</span><span class="hljs-params">()</span> &#123;<br>        tempDirection = Direction.DIRECTION_CENTER;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != mOnAngleChangeListener) &#123;<br>            mOnAngleChangeListener.onStart();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != mOnShakeListener) &#123;<br>            mOnShakeListener.onStart();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å›è°ƒ</span><br><span class="hljs-comment">     * è¿”å›å‚æ•°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> angle æ‘‡åŠ¨è§’åº¦</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callBack</span><span class="hljs-params">(<span class="hljs-type">double</span> angle, <span class="hljs-type">float</span> distance)</span> &#123;<br>        Log.d(<span class="hljs-string">&quot;distance&quot;</span>, distance + <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-keyword">if</span> (Math.abs(distance - lastDistance) &gt;= (baseDistance / mDistanceLevel)) &#123;<br>            lastDistance = distance;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != mOnDistanceLevelListener) &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (distance / (baseDistance / mDistanceLevel));<br>                mOnDistanceLevelListener.onDistanceLevel(level);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != mOnAngleChangeListener) &#123;<br>            mOnAngleChangeListener.angle(angle);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != mOnShakeListener) &#123;<br>            <span class="hljs-keyword">if</span> (CallBackMode.CALL_BACK_MODE_MOVE == mCallBackMode) &#123;<br>                <span class="hljs-keyword">switch</span> (mDirectionMode) &#123;<br>                    <span class="hljs-keyword">case</span> DIRECTION_2_HORIZONTAL:<span class="hljs-comment">// å·¦å³æ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> (ANGLE_0 &lt;= angle &amp;&amp; ANGLE_HORIZONTAL_2D_OF_0P &gt; angle || ANGLE_HORIZONTAL_2D_OF_1P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &#123;<br>                            <span class="hljs-comment">// å³</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_HORIZONTAL_2D_OF_0P &lt;= angle &amp;&amp; ANGLE_HORIZONTAL_2D_OF_1P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å·¦</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_LEFT);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_2_VERTICAL:<span class="hljs-comment">// ä¸Šä¸‹æ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> (ANGLE_VERTICAL_2D_OF_0P &lt;= angle &amp;&amp; ANGLE_VERTICAL_2D_OF_1P &gt; angle) &#123;<br>                            <span class="hljs-comment">// ä¸‹</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_VERTICAL_2D_OF_1P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &#123;<br>                            <span class="hljs-comment">// ä¸Š</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_UP);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_4_ROTATE_0:<span class="hljs-comment">// å››ä¸ªæ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> (ANGLE_4D_OF_0P &lt;= angle &amp;&amp; ANGLE_4D_OF_1P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å³ä¸‹</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_4D_OF_1P &lt;= angle &amp;&amp; ANGLE_4D_OF_2P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸‹</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_4D_OF_2P &lt;= angle &amp;&amp; ANGLE_4D_OF_3P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸Š</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_4D_OF_3P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &#123;<br>                            <span class="hljs-comment">// å³ä¸Š</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_RIGHT);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_4_ROTATE_45:<span class="hljs-comment">// å››ä¸ªæ–¹å‘ æ—‹è½¬45åº¦</span><br>                        <span class="hljs-keyword">if</span> (ANGLE_0 &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_0P &gt; angle || ANGLE_ROTATE45_4D_OF_3P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &#123;<br>                            <span class="hljs-comment">// å³</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_ROTATE45_4D_OF_0P &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_1P &gt; angle) &#123;<br>                            <span class="hljs-comment">// ä¸‹</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_ROTATE45_4D_OF_1P &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_2P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å·¦</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_ROTATE45_4D_OF_2P &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_3P &gt; angle) &#123;<br>                            <span class="hljs-comment">// ä¸Š</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_UP);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_8:<span class="hljs-comment">// å…«ä¸ªæ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> (ANGLE_0 &lt;= angle &amp;&amp; ANGLE_8D_OF_0P &gt; angle || ANGLE_8D_OF_7P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &#123;<br>                            <span class="hljs-comment">// å³</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_0P &lt;= angle &amp;&amp; ANGLE_8D_OF_1P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å³ä¸‹</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_1P &lt;= angle &amp;&amp; ANGLE_8D_OF_2P &gt; angle) &#123;<br>                            <span class="hljs-comment">// ä¸‹</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_2P &lt;= angle &amp;&amp; ANGLE_8D_OF_3P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸‹</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_3P &lt;= angle &amp;&amp; ANGLE_8D_OF_4P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å·¦</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_4P &lt;= angle &amp;&amp; ANGLE_8D_OF_5P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸Š</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_5P &lt;= angle &amp;&amp; ANGLE_8D_OF_6P &gt; angle) &#123;<br>                            <span class="hljs-comment">// ä¸Š</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_UP);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_6P &lt;= angle &amp;&amp; ANGLE_8D_OF_7P &gt; angle) &#123;<br>                            <span class="hljs-comment">// å³ä¸Š</span><br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_RIGHT);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (CallBackMode.CALL_BACK_MODE_STATE_CHANGE == mCallBackMode) &#123;<br>                <span class="hljs-keyword">switch</span> (mDirectionMode) &#123;<br>                    <span class="hljs-keyword">case</span> DIRECTION_2_HORIZONTAL:<span class="hljs-comment">// å·¦å³æ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> ((ANGLE_0 &lt;= angle &amp;&amp; ANGLE_HORIZONTAL_2D_OF_0P &gt; angle || ANGLE_HORIZONTAL_2D_OF_1P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &amp;&amp; tempDirection != Direction.DIRECTION_RIGHT) &#123;<br>                            <span class="hljs-comment">// å³</span><br>                            tempDirection = Direction.DIRECTION_RIGHT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_HORIZONTAL_2D_OF_0P &lt;= angle &amp;&amp; ANGLE_HORIZONTAL_2D_OF_1P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_LEFT) &#123;<br>                            <span class="hljs-comment">// å·¦</span><br>                            tempDirection = Direction.DIRECTION_LEFT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_LEFT);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_2_VERTICAL:<span class="hljs-comment">// ä¸Šä¸‹æ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> (ANGLE_VERTICAL_2D_OF_0P &lt;= angle &amp;&amp; ANGLE_VERTICAL_2D_OF_1P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_DOWN) &#123;<br>                            <span class="hljs-comment">// ä¸‹</span><br>                            tempDirection = Direction.DIRECTION_DOWN;<br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_VERTICAL_2D_OF_1P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_UP) &#123;<br>                            <span class="hljs-comment">// ä¸Š</span><br>                            tempDirection = Direction.DIRECTION_UP;<br>                            mOnShakeListener.direction(Direction.DIRECTION_UP);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_4_ROTATE_0:<span class="hljs-comment">// å››ä¸ªæ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> (ANGLE_4D_OF_0P &lt;= angle &amp;&amp; ANGLE_4D_OF_1P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_DOWN_RIGHT) &#123;<br>                            <span class="hljs-comment">// å³ä¸‹</span><br>                            tempDirection = Direction.DIRECTION_DOWN_RIGHT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_4D_OF_1P &lt;= angle &amp;&amp; ANGLE_4D_OF_2P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_DOWN_LEFT) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸‹</span><br>                            tempDirection = Direction.DIRECTION_DOWN_LEFT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_4D_OF_2P &lt;= angle &amp;&amp; ANGLE_4D_OF_3P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_UP_LEFT) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸Š</span><br>                            tempDirection = Direction.DIRECTION_UP_LEFT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_4D_OF_3P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_UP_RIGHT) &#123;<br>                            <span class="hljs-comment">// å³ä¸Š</span><br>                            tempDirection = Direction.DIRECTION_UP_RIGHT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_RIGHT);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_4_ROTATE_45:<span class="hljs-comment">// å››ä¸ªæ–¹å‘ æ—‹è½¬45åº¦</span><br>                        <span class="hljs-keyword">if</span> ((ANGLE_0 &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_0P &gt; angle || ANGLE_ROTATE45_4D_OF_3P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &amp;&amp; tempDirection != Direction.DIRECTION_RIGHT) &#123;<br>                            <span class="hljs-comment">// å³</span><br>                            tempDirection = Direction.DIRECTION_RIGHT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_ROTATE45_4D_OF_0P &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_1P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_DOWN) &#123;<br>                            <span class="hljs-comment">// ä¸‹</span><br>                            tempDirection = Direction.DIRECTION_DOWN;<br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_ROTATE45_4D_OF_1P &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_2P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_LEFT) &#123;<br>                            <span class="hljs-comment">// å·¦</span><br>                            tempDirection = Direction.DIRECTION_LEFT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_ROTATE45_4D_OF_2P &lt;= angle &amp;&amp; ANGLE_ROTATE45_4D_OF_3P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_UP) &#123;<br>                            <span class="hljs-comment">// ä¸Š</span><br>                            tempDirection = Direction.DIRECTION_UP;<br>                            mOnShakeListener.direction(Direction.DIRECTION_UP);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> DIRECTION_8:<span class="hljs-comment">// å…«ä¸ªæ–¹å‘</span><br>                        <span class="hljs-keyword">if</span> ((ANGLE_0 &lt;= angle &amp;&amp; ANGLE_8D_OF_0P &gt; angle || ANGLE_8D_OF_7P &lt;= angle &amp;&amp; ANGLE_360 &gt; angle) &amp;&amp; tempDirection != Direction.DIRECTION_RIGHT) &#123;<br>                            <span class="hljs-comment">// å³</span><br>                            tempDirection = Direction.DIRECTION_RIGHT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_0P &lt;= angle &amp;&amp; ANGLE_8D_OF_1P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_DOWN_RIGHT) &#123;<br>                            <span class="hljs-comment">// å³ä¸‹</span><br>                            tempDirection = Direction.DIRECTION_DOWN_RIGHT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_RIGHT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_1P &lt;= angle &amp;&amp; ANGLE_8D_OF_2P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_DOWN) &#123;<br>                            <span class="hljs-comment">// ä¸‹</span><br>                            tempDirection = Direction.DIRECTION_DOWN;<br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_2P &lt;= angle &amp;&amp; ANGLE_8D_OF_3P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_DOWN_LEFT) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸‹</span><br>                            tempDirection = Direction.DIRECTION_DOWN_LEFT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_DOWN_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_3P &lt;= angle &amp;&amp; ANGLE_8D_OF_4P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_LEFT) &#123;<br>                            <span class="hljs-comment">// å·¦</span><br>                            tempDirection = Direction.DIRECTION_LEFT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_4P &lt;= angle &amp;&amp; ANGLE_8D_OF_5P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_UP_LEFT) &#123;<br>                            <span class="hljs-comment">// å·¦ä¸Š</span><br>                            tempDirection = Direction.DIRECTION_UP_LEFT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_LEFT);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_5P &lt;= angle &amp;&amp; ANGLE_8D_OF_6P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_UP) &#123;<br>                            <span class="hljs-comment">// ä¸Š</span><br>                            tempDirection = Direction.DIRECTION_UP;<br>                            mOnShakeListener.direction(Direction.DIRECTION_UP);<br>                        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ANGLE_8D_OF_6P &lt;= angle &amp;&amp; ANGLE_8D_OF_7P &gt; angle &amp;&amp; tempDirection != Direction.DIRECTION_UP_RIGHT) &#123;<br>                            <span class="hljs-comment">// å³ä¸Š</span><br>                            tempDirection = Direction.DIRECTION_UP_RIGHT;<br>                            mOnShakeListener.direction(Direction.DIRECTION_UP_RIGHT);<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å›è°ƒ</span><br><span class="hljs-comment">     * ç»“æŸ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callBackFinish</span><span class="hljs-params">()</span> &#123;<br>        tempDirection = Direction.DIRECTION_CENTER;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != mOnAngleChangeListener) &#123;<br>            mOnAngleChangeListener.onFinish();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != mOnShakeListener) &#123;<br>            mOnShakeListener.onFinish();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å›è°ƒæ¨¡å¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">CallBackMode</span> &#123;<br>        <span class="hljs-comment">// æœ‰ç§»åŠ¨å°±ç«‹åˆ»å›è°ƒ</span><br>        CALL_BACK_MODE_MOVE,<br>        <span class="hljs-comment">// åªæœ‰çŠ¶æ€å˜åŒ–çš„æ—¶å€™æ‰å›è°ƒ</span><br>        CALL_BACK_MODE_STATE_CHANGE,<br>        <span class="hljs-comment">//åªæœ‰çŠ¶æ€å˜åŒ–æˆ–è€…è·ç¦»å˜åŒ–çš„æ—¶å€™æ‰å›è°ƒ</span><br>        CALL_BACK_MODE_STATE_DISTANCE_CHANGE<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®å›è°ƒæ¨¡å¼</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> mode å›è°ƒæ¨¡å¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCallBackMode</span><span class="hljs-params">(CallBackMode mode)</span> &#123;<br>        mCallBackMode = mode;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‘‡æ†æ”¯æŒå‡ ä¸ªæ–¹å‘</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DirectionMode</span> &#123;<br>        DIRECTION_2_HORIZONTAL,<span class="hljs-comment">// æ¨ªå‘ å·¦å³ä¸¤ä¸ªæ–¹å‘</span><br>        DIRECTION_2_VERTICAL, <span class="hljs-comment">// çºµå‘ ä¸Šä¸‹ä¸¤ä¸ªæ–¹å‘</span><br>        DIRECTION_4_ROTATE_0, <span class="hljs-comment">// å››ä¸ªæ–¹å‘</span><br>        DIRECTION_4_ROTATE_45, <span class="hljs-comment">// å››ä¸ªæ–¹å‘ æ—‹è½¬45åº¦</span><br>        DIRECTION_8 <span class="hljs-comment">// å…«ä¸ªæ–¹å‘</span><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–¹å‘</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Direction</span> &#123;<br>        DIRECTION_LEFT, <span class="hljs-comment">// å·¦</span><br>        DIRECTION_RIGHT, <span class="hljs-comment">// å³</span><br>        DIRECTION_UP, <span class="hljs-comment">// ä¸Š</span><br>        DIRECTION_DOWN, <span class="hljs-comment">// ä¸‹</span><br>        DIRECTION_UP_LEFT, <span class="hljs-comment">// å·¦ä¸Š</span><br>        DIRECTION_UP_RIGHT, <span class="hljs-comment">// å³ä¸Š</span><br>        DIRECTION_DOWN_LEFT, <span class="hljs-comment">// å·¦ä¸‹</span><br>        DIRECTION_DOWN_RIGHT, <span class="hljs-comment">// å³ä¸‹</span><br>        DIRECTION_CENTER <span class="hljs-comment">// ä¸­é—´</span><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ æ‘‡æ†æ‘‡åŠ¨è§’åº¦çš„ç›‘å¬</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> listener å›è°ƒæ¥å£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnAngleChangeListener</span><span class="hljs-params">(OnAngleChangeListener listener)</span> &#123;<br>        mOnAngleChangeListener = listener;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ æ‘‡åŠ¨çš„ç›‘å¬</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> directionMode ç›‘å¬çš„æ–¹å‘</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> listener      å›è°ƒ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnShakeListener</span><span class="hljs-params">(DirectionMode directionMode, OnShakeListener listener)</span> &#123;<br>        mDirectionMode = directionMode;<br>        mOnShakeListener = listener;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ æ‘‡åŠ¨çš„è·ç¦»å˜åŒ–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnDistanceLevelListener</span><span class="hljs-params">(OnDistanceLevelListener listener)</span> &#123;<br>        mOnDistanceLevelListener = listener;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‘‡åŠ¨æ–¹å‘ç›‘å¬æ¥å£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OnShakeListener</span> &#123;<br>        <span class="hljs-comment">// å¼€å§‹</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">()</span>;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * æ‘‡åŠ¨æ–¹å‘</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> direction æ–¹å‘</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">direction</span><span class="hljs-params">(Direction direction)</span>;<br><br>        <span class="hljs-comment">// ç»“æŸ</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFinish</span><span class="hljs-params">()</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‘‡åŠ¨è§’åº¦çš„ç›‘å¬æ¥å£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OnAngleChangeListener</span> &#123;<br>        <span class="hljs-comment">// å¼€å§‹</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">()</span>;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * æ‘‡æ†è§’åº¦å˜åŒ–</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@param</span> angle è§’åº¦[0,360)</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">angle</span><span class="hljs-params">(<span class="hljs-type">double</span> angle)</span>;<br><br>        <span class="hljs-comment">// ç»“æŸ</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFinish</span><span class="hljs-params">()</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‘‡åŠ¨è·ç¦»</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OnDistanceLevelListener</span> &#123;<br><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDistanceLevel</span><span class="hljs-params">(<span class="hljs-type">int</span> level)</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> CallBackMode <span class="hljs-title function_">getCallBackMode</span><span class="hljs-params">(<span class="hljs-type">int</span> mode)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (mode) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">return</span> CallBackMode.CALL_BACK_MODE_MOVE;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">return</span> CallBackMode.CALL_BACK_MODE_STATE_CHANGE;<br>        &#125;<br>        <span class="hljs-keyword">return</span> mCallBackMode;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>androidå¼€å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>andorid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤©æ°”æ—¶é’Ÿ</title>
    <link href="/posts/2581b914/"/>
    <url>/posts/2581b914/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç©esp32ï¼Œæ‰‹è¾¹æ­£å¥½è¿˜æœ‰ä¸€å—16bitçš„TFT_LCDå±å¹•ï¼Œå¤§å°åªæœ‰135Ã—240ï¼Œæ€æ¥æƒ³å»è¿˜æ˜¯ç”¨æ¥æ˜¾ç¤ºæ—¶é—´å’Œå¤©æ°”å§ğŸ¤”èŠ±è´¹ä¸€ç•ªå°å¿ƒæ€ï¼Œè¿˜æ·»ä¸Šäº†ä¸€ä¸ªåœ†å½¢å¸¦æŒ‡é’ˆçš„å¯ä»¥è½¬åŠ¨çš„è¡¨ğŸ˜“ï¼Œå¤©æ°”ç”¨çš„å¿ƒçŸ¥å¤©æ°”æä¾›çš„apiï¼Œæ–¹ä¾¿ä¸”å…è´¹ä¸”è´´å¿ƒçš„é€ç²¾ç¾å¤©æ°”å›¾æ ‡ä¸€ä»½ğŸ˜»</p><span id="more"></span><p>æˆå“å»ä»“åº“çœ‹å§ï¼Œå°±ä¸è´´å›¾äº†ğŸ¤­</p><blockquote><p>Gitee: <a href="https://gitee.com/Zone2515/esp32">å¤©æ°”æ—¶é’Ÿ</a></p></blockquote><h2 id="è¿WiFi"><a href="#è¿WiFi" class="headerlink" title="è¿WiFi"></a>è¿WiFi</h2><p>è¿‡ç¨‹åŸºæœ¬æ˜¯ä¸å˜çš„ï¼Œè®°å½•ä¸€ä¸‹æ–¹ä¾¿copy</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WiFi.h&gt;</span></span><br><br><span class="hljs-comment">//è¿™é‡Œæ”¹ç”¨char*å˜é‡ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯Ardunioä¼šæœ‰è­¦å‘Šä¼¼ä¹æ˜¯è®©æ”¹æˆStringï¼Œæ”¹äº†ä¹‹åæŠ¥é”™ï¼ˆçƒ¦ï¼‰ï¼Œç°åœ¨å°±ç›´æ¥å®šä¹‰æˆå®ï¼Œä»¥åå†çœ‹çœ‹ã€‚</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ssid <span class="hljs-string">&quot;balabala&quot;</span> <span class="hljs-comment">// ä¿®æ”¹wifiåç§°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> password <span class="hljs-string">&quot;*******&quot;</span> <span class="hljs-comment">// ä¿®æ”¹wifiå¯†ç </span></span><br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>&#123;<br>    ...<br>    WiFi.<span class="hljs-built_in">begin</span>(ssid, password);<br>    <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>);<br>    <span class="hljs-keyword">while</span> (WiFi.<span class="hljs-built_in">status</span>() != WL_CONNECTED) &#123;<br>        <span class="hljs-comment">// ç­‰å¾…è¿æ¥ï¼Œloadingæ˜¯ä¸€ä¸ªåŠ è½½åŠ¨ç”»ï¼Œä¸€ä¼šå„¿è¯´</span><br>        <span class="hljs-comment">//for (byte n = 0; n &lt; 10; n++) &#123;</span><br>        <span class="hljs-comment">//    loading(&quot;Connecting Wifi&quot;, 50);</span><br>        <span class="hljs-comment">//&#125;</span><br>    &#125;<br>    <span class="hljs-comment">//è¿æ¥æˆåŠŸ</span><br>    <span class="hljs-keyword">if</span> (WiFi.<span class="hljs-built_in">status</span>() == WL_CONNECTED) &#123;<br>        Serial.<span class="hljs-built_in">println</span>(<span class="hljs-string">&quot;wifi is connected!&quot;</span>);<br>        Serial.<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;SSID: &quot;</span>);<br>        Serial.<span class="hljs-built_in">println</span>(WiFi.<span class="hljs-built_in">SSID</span>());<br>        IPAddress ip = WiFi.<span class="hljs-built_in">localIP</span>();<br>        Serial.<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IP Address: &quot;</span>);<br>        Serial.<span class="hljs-built_in">println</span>(ip);<br>    &#125;<br>    ...<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿ä¸ŠWiFiï¼Œå°±å¯ä»¥ç”¨å®ƒä¸Šç½‘äº†ï¼ˆè¿çš„WiFiç¡®ä¿èƒ½ä¸Šç½‘ğŸ«µ</p><p>è¿™é‡Œç…§ç€åˆ«äººåšäº†ä¸ªåŠ¨ç”»ï¼Œç­‰å¾…è¿æ¥WiFiå°±ä¸ä¼šæ— èŠäº†ï¼ˆç¡®ä¿¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;TFT_eSPI.h&gt;</span></span><br><br>TFT_eSPI tft = <span class="hljs-built_in">TFT_eSPI</span>();<br>TFT_eSprite clk = <span class="hljs-built_in">TFT_eSprite</span>(&amp;tft);<br>byte loadNum = <span class="hljs-number">6</span>; <span class="hljs-comment">//è¿›åº¦æ¡é•¿åº¦</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loading</span><span class="hljs-params">(String msg, byte delayTime)</span> </span>&#123;<br>  clk.<span class="hljs-built_in">createSprite</span>(<span class="hljs-number">200</span>, <span class="hljs-number">50</span>);<br>  clk.<span class="hljs-built_in">fillSprite</span>(<span class="hljs-number">0x0000</span>);<br>  clk.<span class="hljs-built_in">drawRoundRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>, <span class="hljs-number">16</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0xFFFF</span>);<br>  clk.<span class="hljs-built_in">fillRoundRect</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, loadNum, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0xFFFF</span>);<br>  clk.<span class="hljs-built_in">setTextColor</span>(TFT_GREEN, <span class="hljs-number">0x0000</span>);<br>  clk.<span class="hljs-built_in">setTextDatum</span>(CC_DATUM);<br>  clk.<span class="hljs-built_in">drawString</span>(msg, <span class="hljs-number">100</span>, <span class="hljs-number">40</span>, <span class="hljs-number">2</span>);<br>  clk.<span class="hljs-built_in">pushSprite</span>(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>);<br>  clk.<span class="hljs-built_in">deleteSprite</span>();<br>  loadNum += <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> (loadNum &gt;= <span class="hljs-number">195</span>) &#123;<br>    loadNum = <span class="hljs-number">195</span>;<br>  &#125;<br>  <span class="hljs-built_in">delay</span>(delayTime);<br>&#125;<br><span class="hljs-comment">//åŠ è½½æˆåŠŸåè¿‡æ¸¡ï¼ˆåŠ¨ç”»ï¼‰</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">successload</span><span class="hljs-params">(String msg)</span> </span>&#123;<br>  loadNum = <span class="hljs-number">6</span>;<br>  clk.<span class="hljs-built_in">createSprite</span>(<span class="hljs-number">200</span>, <span class="hljs-number">50</span>);<br>  clk.<span class="hljs-built_in">fillSprite</span>(<span class="hljs-number">0x0000</span>);<br>  clk.<span class="hljs-built_in">setTextDatum</span>(CC_DATUM);<br>  clk.<span class="hljs-built_in">setTextColor</span>(TFT_GREEN, <span class="hljs-number">0x0000</span>);<br>  clk.<span class="hljs-built_in">drawString</span>(msg, <span class="hljs-number">100</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>);<br>  clk.<span class="hljs-built_in">pushSprite</span>(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>);<br>  clk.<span class="hljs-built_in">deleteSprite</span>();<br>  <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>);<br>  tft.<span class="hljs-built_in">fillScreen</span>(<span class="hljs-number">0x0000</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="æ—¶é’Ÿ"><a href="#æ—¶é’Ÿ" class="headerlink" title="æ—¶é’Ÿ"></a>æ—¶é’Ÿ</h2><p>æœ‰äº†ç½‘å°±å¯ä»¥è·å–ç½‘ç»œæ—¶é—´äº†ï¼Œä¸€é¡¿æœç´¢å°±è¢«æˆ‘æ‰¾åˆ°å•¦ï¼Œæ•´ç†ä¸€ä¸‹å¦‚ä½•è·å–å®æ—¶ç½‘ç»œæ—¶é—´ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åcopyğŸ¤­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WiFiUdp.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;NTPClient.h&gt;</span></span><br><br>WiFiUDP ntpUDP;<br><span class="hljs-function">NTPClient <span class="hljs-title">timeClient</span><span class="hljs-params">(ntpUDP)</span></span>;<br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>&#123;<br>    ...<span class="hljs-comment">//åˆå§‹åŒ–ç½‘ç»œï¼Œtftç­‰</span><br>    timeClient.<span class="hljs-built_in">setTimeOffset</span>(<span class="hljs-number">28800</span>);<span class="hljs-comment">//è®¾ç½®æ—¶åŒºåå·®</span><br>    timeClient.<span class="hljs-built_in">begin</span>();<br>    ...<br>&#125;<br><span class="hljs-comment">// è·å–å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼Œå¹¶è°ƒç”¨æ˜¾ç¤ºå‡½æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateDate</span><span class="hljs-params">()</span></span>&#123;<br>  timeClient.<span class="hljs-built_in">update</span>();<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> epochTime = timeClient.<span class="hljs-built_in">getEpochTime</span>();<br>  <span class="hljs-type">int</span> hour = timeClient.<span class="hljs-built_in">getHours</span>();<br>  <span class="hljs-type">int</span> minu = timeClient.<span class="hljs-built_in">getMinutes</span>();<br>  <span class="hljs-type">int</span> secs = timeClient.<span class="hljs-built_in">getSeconds</span>();<br>  <span class="hljs-type">int</span> weekday = timeClient.<span class="hljs-built_in">getDay</span>();<br>  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">tm</span>* ptm = <span class="hljs-built_in">gmtime</span>((<span class="hljs-type">time_t</span>*)&amp;epochTime);<br>  <span class="hljs-type">int</span> day = ptm-&gt;tm_mday;<br>  <span class="hljs-type">int</span> month = ptm-&gt;tm_mon + <span class="hljs-number">1</span>;<br>  <span class="hljs-type">int</span> year = ptm-&gt;tm_year+<span class="hljs-number">1900</span>;<br>  <span class="hljs-comment">//åœ†è¡¨ç›˜</span><br>  <span class="hljs-built_in">showClock</span>(hour,minu,secs,<span class="hljs-number">60</span>,<span class="hljs-number">100</span>,<span class="hljs-number">60</span>);<br>  <span class="hljs-comment">//æ–‡å­—  </span><br>  <span class="hljs-built_in">showDate</span>(hour, minu,secs,year,month, day, weekday);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ˜¾ç¤ºæ–‡å­—æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯è°ƒè°ƒä½ç½®ï¼Œæ”¹æ”¹é¢œè‰²ï¼Œå˜å˜å¤§å°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showText</span><span class="hljs-params">(<span class="hljs-type">int16_t</span> x, <span class="hljs-type">int16_t</span> y, <span class="hljs-type">uint8_t</span> font, <span class="hljs-type">uint8_t</span> s, <span class="hljs-type">uint16_t</span> fg, <span class="hljs-type">uint16_t</span> bg, <span class="hljs-type">const</span> String str)</span> </span>&#123;<br>  tft.<span class="hljs-built_in">setCursor</span>(x, y, font);<br>  tft.<span class="hljs-built_in">setTextColor</span>(fg, bg);<br>  tft.<span class="hljs-built_in">setTextSize</span>(s);<br>  tft.<span class="hljs-built_in">println</span>(str);<br>&#125;<br><span class="hljs-comment">//æ•°å­—è½¬æˆå¯¹åº”çš„æ–‡å­—</span><br><span class="hljs-function">String <span class="hljs-title">getWeekdays</span><span class="hljs-params">(<span class="hljs-type">int</span> weekday)</span> </span>&#123;<br>  String res;<br>  <span class="hljs-keyword">switch</span> (weekday) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: res = <span class="hljs-string">&quot;Mon. &quot;</span>; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: res = <span class="hljs-string">&quot;Tues.&quot;</span>; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: res = <span class="hljs-string">&quot;Wed. &quot;</span>; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: res = <span class="hljs-string">&quot;Thur.&quot;</span>; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: res = <span class="hljs-string">&quot;Fri. &quot;</span>; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>: res = <span class="hljs-string">&quot;Sat. &quot;</span>; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>: res = <span class="hljs-string">&quot;Sun. &quot;</span>; <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showDate</span><span class="hljs-params">(<span class="hljs-type">int</span> hou, <span class="hljs-type">int</span> minu, <span class="hljs-type">int</span> secs,<span class="hljs-type">int</span> year, <span class="hljs-type">int</span> mon, <span class="hljs-type">int</span> days, <span class="hljs-type">int</span> weekday)</span> </span>&#123;<br>  String shour,sminu,ssecs;<br>  <span class="hljs-keyword">if</span> (hou &lt; <span class="hljs-number">10</span>) &#123;<br>    shour = <span class="hljs-string">&quot;0&quot;</span>+(String)hou+<span class="hljs-string">&quot;:&quot;</span>;<br>  &#125; <span class="hljs-keyword">else</span> shour = (String)hou+<span class="hljs-string">&quot;:&quot;</span>;<br>  <span class="hljs-keyword">if</span> (minu &lt; <span class="hljs-number">10</span>) &#123;<br>    sminu = <span class="hljs-string">&quot;0&quot;</span>+(String)minu;<br>  &#125; <span class="hljs-keyword">else</span> sminu = (String)minu;<br>  <span class="hljs-keyword">if</span> (secs &lt; <span class="hljs-number">10</span>) &#123;<br>    ssecs = <span class="hljs-string">&quot;0&quot;</span>+(String)secs;<br>  &#125; <span class="hljs-keyword">else</span> ssecs = (String)secs;<br>  <span class="hljs-built_in">showText</span>(<span class="hljs-number">15</span>, <span class="hljs-number">30</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, TFT_WHITE, TFT_BLACK, shour+sminu);<br>  <span class="hljs-built_in">showText</span>(<span class="hljs-number">90</span>, <span class="hljs-number">40</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, TFT_WHITE , TFT_BLACK, ssecs);<br>  <span class="hljs-built_in">showText</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, TFT_CYAN , TFT_BLACK, (String)mon + <span class="hljs-string">&quot;/&quot;</span> + (String)days+<span class="hljs-string">&quot;/&quot;</span>+(String)year+<span class="hljs-string">&quot; &quot;</span>+<span class="hljs-built_in">getWeekdays</span>(weekday));<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ†æ ‡ç›˜çš„æ˜¾ç¤ºåŸç†ä¹Ÿéå¸¸ç®€å•ã€‚ä»¥æ˜¾ç¤ºç§’é’ˆä¸ºä¾‹ï¼Œåšä¸ªç®€å•è¯´æ˜ã€‚</p><p><a href="https://imgse.com/i/pCfDn9f"><img src="https://s1.ax1x.com/2023/07/12/pCfDn9f.jpg" alt="pCfDn9f.jpg"></a></p><p>æ ¹æ®æ—¶é—´ç¡®å®šä¸¤ä¸ªç«¯ç‚¹å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;math.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showClock</span><span class="hljs-params">(<span class="hljs-type">int</span> hou, <span class="hljs-type">int</span> minu, <span class="hljs-type">int</span> secs,<span class="hljs-type">int</span> cx, <span class="hljs-type">int</span> cy, <span class="hljs-type">int</span> size)</span></span>&#123;<br>  <span class="hljs-type">int</span> sr =  size/<span class="hljs-number">2</span>;<br>  <span class="hljs-type">int</span> mr =  sr*<span class="hljs-number">3</span>/<span class="hljs-number">4</span>;<br>  <span class="hljs-type">int</span> hr =  sr/<span class="hljs-number">2</span>;<br><br>  <span class="hljs-type">int</span> sx = (<span class="hljs-type">int</span>)(sr+sr*<span class="hljs-built_in">sin</span>((<span class="hljs-type">double</span>)secs*M_PI/<span class="hljs-number">30</span>));<br>  <span class="hljs-type">int</span> sy = (<span class="hljs-type">int</span>)(sr-sr*<span class="hljs-built_in">cos</span>((<span class="hljs-type">double</span>)secs*M_PI/<span class="hljs-number">30</span>));<br>  <span class="hljs-type">int</span> mx = (<span class="hljs-type">int</span>)(sr+mr*<span class="hljs-built_in">sin</span>((<span class="hljs-type">double</span>)minu*M_PI/<span class="hljs-number">30</span>));<br>  <span class="hljs-type">int</span> my = (<span class="hljs-type">int</span>)(sr-mr*<span class="hljs-built_in">cos</span>((<span class="hljs-type">double</span>)minu*M_PI/<span class="hljs-number">30</span>));<br>  <span class="hljs-type">int</span> hx = (<span class="hljs-type">int</span>)(sr+hr*<span class="hljs-built_in">sin</span>((<span class="hljs-type">double</span>)hou*M_PI/<span class="hljs-number">6</span>));<br>  <span class="hljs-type">int</span> hy = (<span class="hljs-type">int</span>)(sr-hr*<span class="hljs-built_in">cos</span>((<span class="hljs-type">double</span>)hou*M_PI/<span class="hljs-number">6</span>));<br><br>  clk.<span class="hljs-built_in">createSprite</span>(size+<span class="hljs-number">6</span>, size+<span class="hljs-number">6</span>);  <br>  clk.<span class="hljs-built_in">fillSprite</span>(TFT_BLACK);<br>  clk.<span class="hljs-built_in">drawCircle</span>(sr,sr,sr,TFT_WHITE);<br>  <br>  clk.<span class="hljs-built_in">fillRect</span>(sr<span class="hljs-number">-2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,TFT_WHITE);<br>  clk.<span class="hljs-built_in">fillRect</span>(size<span class="hljs-number">-6</span>,sr<span class="hljs-number">-2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,TFT_WHITE);<br>  clk.<span class="hljs-built_in">fillRect</span>(sr<span class="hljs-number">-2</span>,size<span class="hljs-number">-6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,TFT_WHITE);<br>  clk.<span class="hljs-built_in">fillRect</span>(<span class="hljs-number">0</span>,sr<span class="hljs-number">-2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,TFT_WHITE);<br><br>  clk.<span class="hljs-built_in">drawLine</span>(sr,sr,sx,sy,TFT_RED);<br>  clk.<span class="hljs-built_in">drawLine</span>(sr,sr,mx,my,TFT_WHITE);<br>  clk.<span class="hljs-built_in">drawLine</span>(sr,sr,hx,hy,TFT_YELLOW);<br>  clk.<span class="hljs-built_in">pushSprite</span>(cx-size/<span class="hljs-number">2</span>, cy-size/<span class="hljs-number">2</span>);<br>  clk.<span class="hljs-built_in">deleteSprite</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¤©æ°”"><a href="#å¤©æ°”" class="headerlink" title="å¤©æ°”"></a>å¤©æ°”</h2><p>å¿ƒçŸ¥å¤©æ°”æ³¨å†Œè´¦å·åå°±èƒ½å…è´¹ç”³è¯·äº§å“ä½¿ç”¨apiäº†ï¼ˆç™½å«–å…šç‹‚å–œğŸ¤­<br>é™¤äº†å‘é€httpè¯·æ±‚å¤–ï¼Œè¿˜è¦è§£æè¿”å›çš„jsonå­—ç¬¦ä¸²</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;HTTPClient.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ArduinoJson.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;image.h&quot;</span></span><br><br><span class="hljs-function">DynamicJsonDocument <span class="hljs-title">doc</span><span class="hljs-params">(<span class="hljs-number">512</span>)</span></span>;<br><br><span class="hljs-comment">//å‘é€è¯·æ±‚ï¼Œè§£æå“åº”ï¼Œè°ƒç”¨æ˜¾ç¤ºå‡½æ•°ã€‚ key city è®°å¾—æ›¿æ¢</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateWeather</span><span class="hljs-params">()</span> </span>&#123;<br>  HTTPClient http;<br>  http.<span class="hljs-built_in">begin</span>(<span class="hljs-string">&quot;https://api.seniverse.com/v3/weather/now.json?key=&quot;</span>+key+<span class="hljs-string">&quot;&amp;location=&quot;</span>+city+<span class="hljs-string">&quot;&amp;language=en&amp;unit=c&quot;</span>);<br>  <span class="hljs-type">int</span> httpCode = http.<span class="hljs-built_in">GET</span>();<br>  <span class="hljs-keyword">if</span> (httpCode &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;<br>      String payload = http.<span class="hljs-built_in">getString</span>();<br>      <span class="hljs-built_in">deserializeJson</span>(doc, payload);<br>      Serial.<span class="hljs-built_in">println</span>(payload);<br>      JsonObject root = doc.<span class="hljs-built_in">as</span>&lt;JsonObject&gt;();<br>      JsonObject  result = root[<span class="hljs-string">&quot;results&quot;</span>][<span class="hljs-number">0</span>];<br>      JsonObject location = result[<span class="hljs-string">&quot;location&quot;</span>];<br>      String name = location[<span class="hljs-string">&quot;name&quot;</span>];<br>      String country = location[<span class="hljs-string">&quot;country&quot;</span>];<br>      JsonObject now = result[<span class="hljs-string">&quot;now&quot;</span>];<br>      String text = now[<span class="hljs-string">&quot;text&quot;</span>];<br>      String code = now[<span class="hljs-string">&quot;code&quot;</span>];<br>      String temperature = now[<span class="hljs-string">&quot;temperature&quot;</span>];<br>      String last_update = result[<span class="hljs-string">&quot;last_update&quot;</span>];<br>      <br>      <span class="hljs-built_in">showWeather</span>(name,country,text,code.<span class="hljs-built_in">toInt</span>(),temperature);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    Serial.<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[HTTP] GET... failed, error: %s\n&quot;</span>, http.<span class="hljs-built_in">errorToString</span>(httpCode).<span class="hljs-built_in">c_str</span>());<br>  &#125;<br>  http.<span class="hljs-built_in">end</span>();<br>&#125;<br><span class="hljs-comment">//weatherIconsäºŒç»´æ•°ç»„ï¼Œå­˜å‚¨å¤©æ°”å›¾æ ‡ï¼Œsheshiduå­˜å‚¨â„ƒç¬¦å·ï¼Œå‡åœ¨image.hä¸­å®šä¹‰</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">showWeather</span><span class="hljs-params">(String name,String country,String text,<span class="hljs-type">int</span> code,String temperature)</span></span>&#123;<br>  clk.<span class="hljs-built_in">createSprite</span>(<span class="hljs-number">110</span>, <span class="hljs-number">135</span>);<br>  clk.<span class="hljs-built_in">fillSprite</span>(TFT_BLACK);<br>  clk.<span class="hljs-built_in">setSwapBytes</span>(<span class="hljs-literal">true</span>);<br>  clk.<span class="hljs-built_in">setTextColor</span>(TFT_CYAN, TFT_BLACK);<br>  clk.<span class="hljs-built_in">setCursor</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>);<br>  clk.<span class="hljs-built_in">setTextSize</span>(<span class="hljs-number">2</span>);<br>  clk.<span class="hljs-built_in">println</span>(name+<span class="hljs-string">&quot; &quot;</span>+country);<br>  clk.<span class="hljs-built_in">setTextColor</span>(TFT_WHITE, TFT_BLACK);<br>  <span class="hljs-keyword">if</span>(code==<span class="hljs-number">99</span>) code = <span class="hljs-number">39</span>;<br>  clk.<span class="hljs-built_in">pushImage</span>(<span class="hljs-number">0</span>,<span class="hljs-number">40</span>,<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,weatherIcons[code]);<br>  clk.<span class="hljs-built_in">setCursor</span>(<span class="hljs-number">5</span>, <span class="hljs-number">95</span>, <span class="hljs-number">1</span>);<br>  clk.<span class="hljs-built_in">setTextSize</span>(<span class="hljs-number">2</span>);<br>  clk.<span class="hljs-built_in">println</span>(text);<br>  clk.<span class="hljs-built_in">setCursor</span>(<span class="hljs-number">70</span>, <span class="hljs-number">40</span>, <span class="hljs-number">1</span>);<br>  clk.<span class="hljs-built_in">setTextSize</span>(<span class="hljs-number">2</span>);<br>  clk.<span class="hljs-built_in">println</span>(temperature);<br>  clk.<span class="hljs-built_in">pushImage</span>(<span class="hljs-number">70</span>,<span class="hljs-number">60</span>,<span class="hljs-number">20</span>,<span class="hljs-number">20</span>,sheshidu);<br>  clk.<span class="hljs-built_in">pushSprite</span>(<span class="hljs-number">130</span>, <span class="hljs-number">0</span>);<br>  clk.<span class="hljs-built_in">deleteSprite</span>();<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ç»¼åˆ"><a href="#ç»¼åˆ" class="headerlink" title="ç»¼åˆ"></a>ç»¼åˆ</h2><p>ä¸¤ä¸ªåŠŸèƒ½æ¨¡å—éƒ½å®ç°äº†ï¼Œç°åœ¨å°±æ˜¯ä»»åŠ¡è°ƒåº¦çš„é—®é¢˜ï¼Œåˆæ˜¯ä¸€é¡¿æœï¼Œæˆ‘è§‰å¾—TaskSchedulerè¿™ä¸ªåº“ä¸é”™ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;TaskScheduler.h&gt;</span></span><br><br>Scheduler runner;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateDate</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateWeather</span><span class="hljs-params">()</span></span>;<br><span class="hljs-comment">//æ—¶é—´æ¯0.1msåˆ·æ–°ä¸€æ¬¡</span><br><span class="hljs-function">Task <span class="hljs-title">dateTask</span><span class="hljs-params">(<span class="hljs-number">100</span>, TASK_FOREVER, &amp;updateDate)</span></span>;<br><span class="hljs-comment">//å¤©æ°”æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡</span><br><span class="hljs-function">Task <span class="hljs-title">weatherTask</span><span class="hljs-params">(<span class="hljs-number">60000</span>, TASK_FOREVER, &amp;updateWeather)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>&#123;<br>    ...<br>    runner.<span class="hljs-built_in">init</span>();<br>    runner.<span class="hljs-built_in">addTask</span>(dateTask);<br>    runner.<span class="hljs-built_in">addTask</span>(weatherTask);<br>    dateTask.<span class="hljs-built_in">enable</span>();<br>    weatherTask.<span class="hljs-built_in">enable</span>();<br>    ...<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>&#123;<br>    runner.<span class="hljs-built_in">execute</span>();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è®°å½•å®Œæ¯•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å•ç‰‡æœºå¼€å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>esp32</tag>
      
      <tag>ç²¾é€‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
